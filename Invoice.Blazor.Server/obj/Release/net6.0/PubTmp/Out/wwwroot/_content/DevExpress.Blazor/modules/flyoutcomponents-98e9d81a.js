import{_ as t}from"./_tslib-6e8ca86b.js";import{V as s,D as e,P as i,c as o,a,b as r,C as n}from"./popup-e5c1aca3.js";import{B as l}from"./getPopupRootSingleton-f8347fe3.js";import{P as h}from"./point-9c6ab88a.js";import{S as c,b as d}from"./rect-7fc5c2ef.js";import{D as p,a as m}from"./popupportal-85248f1b.js";import{L as u}from"./layouthelper-4b19d191.js";import{T as f}from"./transformhelper-ebad0156.js";import{e as g}from"./property-d3853089.js";import{n as y}from"./custom-element-bd7061f2.js";import{s as b,r as w,$ as C}from"./lit-element-b0a6fcba.js";import{i as S,d as E}from"./events-interseptor-eeff27a3.js";import"./rafaction-bba7928b.js";import"./positiontracker-dba18a16.js";import"./supportcaptureelement-51f73fdc.js";import"./logicaltreehelper-15991dcb.js";import"./dx-ui-element-de378e9d.js";import"./lit-element-base-af247167.js";import"./data-qa-utils-8be7c726.js";import"./branch-2ea85171.js";import"./capturemanager-91fa2b2d.js";import"./eventhelper-8570b930.js";import"./nameof-factory-64d95f5b.js";import"./custom-events-helper-18f7786a.js";var v;var P;!function(t){t.top="top",t.bottom="bottom",t.end="end",t.start="start"}(P||(P={}));let A=v=class extends b{constructor(){super(...arguments),this.slotChangedHandler=this.handleSlotChanged.bind(this),this.arrow=null,this._alignment=P.bottom,this.position=s.zero,this.serverClass=null,this.clientClass=null,this.cssClass=null}get alignment(){return this._alignment}set alignment(t){const s=this._alignment;this._alignment=t,this.clientClass=this.calcClientCssClass(t),this.requestUpdate("alignment",s)}calcClientCssClass(t){return`dxbl-popover-${t}`}get arrowSize(){return this.arrow?v.calcSizeWithMargins(this.arrow,u.getRelativeElementRect(this.arrow).size):c.Empty}static calcSizeWithMargins(t,s){const e=window.getComputedStyle(t),i=parseFloat(e.marginLeft),o=parseFloat(e.marginRight),a=parseFloat(e.marginTop),r=parseFloat(e.marginBottom);return new c(s.width+i+o,s.height+a+r)}static get styles(){return w`
            :host {
                display: block;
            }
        }`}willUpdate(t){if(t.has("serverClass")||t.has("clientClass")){const t=[];this.clientClass&&this.clientClass.split(" ").forEach((s=>t.push(s))),this.serverClass&&this.serverClass.split(" ").forEach((s=>t.push(s))),this.cssClass=t.join(" ")}}updated(t){if(this.arrow&&t.has("position"))switch(this.alignment){case P.bottom:this.arrow.style.transform=f.translateWithoutFloor(Math.floor(this.position.x),.5);break;case P.top:this.arrow.style.transform=f.translateWithoutFloor(Math.floor(this.position.x),-.5);break;case P.start:this.arrow.style.transform=f.translateWithoutFloor(-.5,Math.floor(this.position.y));break;case P.end:this.arrow.style.transform=f.translateWithoutFloor(.5,Math.floor(this.position.y))}t.has("cssClass")&&(this.className=this.cssClass?this.cssClass:"")}render(){return C`
            <slot @slotchange="${this.slotChangedHandler}"></slot>
        `}handleSlotChanged(t){const s=t.target.assignedNodes();for(const t in s){const e=s[t];if(e instanceof HTMLElement){this.arrow=e;break}}}};t([g({reflect:!1})],A.prototype,"position",void 0),t([g({type:String,attribute:"server-class"})],A.prototype,"serverClass",void 0),t([g({reflect:!1})],A.prototype,"clientClass",void 0),t([g({reflect:!1})],A.prototype,"cssClass",void 0),t([g({reflect:!1})],A.prototype,"alignment",null),A=v=t([y("dxbl-flyout-arrow")],A);var T;!function(t){t.Fade="fade",t.None="none"}(T||(T={}));let x=class extends p{constructor(){super(...arguments),this.arrowSlotChangeHandler=this.handleArrowSlotChange.bind(this),this._arrow=null,this._arrowAlignment=P.bottom,this.serverClass=null,this.cssClass=null,this.animationType=T.Fade,this.animationEnabled=!1}get arrow(){return this._arrow}get arrowAlignment(){return this._arrowAlignment}set arrowAlignment(t){this._arrowAlignment=t}calcAnimationTypeCssClass(){return`dxbl-flyout-dialog-${this.animationType} dxbl-flyout-dialog-show`}willUpdate(t){if(t.has("serverClass")||t.has("animationEnabled")||t.has("animationType")){const t=[];if(this.serverClass&&this.serverClass.split(" ").forEach((s=>t.push(s))),this.animationEnabled&&this.animationType!==T.None){const s=t.indexOf(`dxbl-flyout-dialog-${this.animationType}`,0),e=this.calcAnimationTypeCssClass();s>-1?t.splice(s,1,e):t.push(e)}this.cssClass=t.join(" ")}}updated(t){t.has("cssClass")&&(this.className=this.cssClass?this.cssClass:"")}render(){return C`
            <slot></slot>
            <slot name="arrow" @slotchange="${this.arrowSlotChangeHandler}"></slot>
        `}handleArrowSlotChange(t){const s=t.target.assignedNodes();this._arrow=s[0]}};var R,j;t([g({type:String,attribute:"server-class"})],x.prototype,"serverClass",void 0),t([g({reflect:!1})],x.prototype,"cssClass",void 0),t([g({type:String,attribute:"animation-type"})],x.prototype,"animationType",void 0),t([g({type:Boolean,reflect:!1})],x.prototype,"animationEnabled",void 0),x=t([y("dxbl-flyout-dialog")],x),function(t){t[t.TopStart=1]="TopStart",t[t.Top=2]="Top",t[t.TopEnd=4]="TopEnd",t[t.RightStart=8]="RightStart",t[t.Right=16]="Right",t[t.RightEnd=32]="RightEnd",t[t.BottomStart=64]="BottomStart",t[t.Bottom=128]="Bottom",t[t.BottomEnd=256]="BottomEnd",t[t.LeftStart=512]="LeftStart",t[t.Left=1024]="Left",t[t.LeftEnd=2048]="LeftEnd"}(j||(j={}));class B extends n{constructor(t,s,e,i,o,a){super(s,e,i,o,a),this.flyoutPosition=t}}let L=R=class extends e{constructor(){super(),this.slotChangedHandler=this.handleSlotChange.bind(this),this.dialog=null,this.flyoutDistance=null,this.flyoutOffset=null,this.calcStartAlignment=()=>0,this.calcEndAlignment=(t,s)=>s-t,this.calcAlignment=(t,s)=>s/2-t/2,this.placement=i.Custom,this.fitToRestriction=!0,this.flyoutPosition=0}get actualDistance(){var t;return null!==(t=this.flyoutDistance)&&void 0!==t?t:2}get actualOffset(){var t;return null!==(t=this.flyoutOffset)&&void 0!==t?t:0}get branchType(){return l.DropDown}get child(){return this.root}processCustomPlacement(t,s){return this.calcCustomPlacements(t,s)}calcCustomPlacements(t,s){const e=[];if(!this.dialog||!this.dialog.arrow)return e;const i=this.getBounds(s),o=this.getBounds(t),a=this.dialog.arrow.arrowSize;return this.flyoutPosition&j.Bottom&&e.push(this.calcBottomPlacement(i,a,this.calcAlignment(o.width,i.width),j.Bottom)),this.flyoutPosition&j.BottomStart&&e.push(this.calcBottomPlacement(i,a,this.calcStartAlignment(),j.BottomStart)),this.flyoutPosition&j.BottomEnd&&e.push(this.calcBottomPlacement(i,a,this.calcEndAlignment(o.width,i.width),j.BottomEnd)),this.flyoutPosition&j.Top&&e.push(this.calcTopPlacement(o,a,this.calcAlignment(o.width,i.width),j.Top)),this.flyoutPosition&j.TopStart&&e.push(this.calcTopPlacement(o,a,this.calcStartAlignment(),j.TopStart)),this.flyoutPosition&j.TopEnd&&e.push(this.calcTopPlacement(o,a,this.calcEndAlignment(o.width,i.width),j.TopEnd)),this.flyoutPosition&j.Left&&e.push(this.calcLeftPlacement(o,a,this.calcAlignment(o.height,i.height),j.Left)),this.flyoutPosition&j.LeftStart&&e.push(this.calcLeftPlacement(o,a,this.calcStartAlignment(),j.LeftStart)),this.flyoutPosition&j.LeftEnd&&e.push(this.calcLeftPlacement(o,a,this.calcEndAlignment(o.height,i.height),j.LeftEnd)),this.flyoutPosition&j.Right&&e.push(this.calcRightPlacement(i,a,this.calcAlignment(o.height,i.height),j.Right)),this.flyoutPosition&j.RightStart&&e.push(this.calcRightPlacement(i,a,this.calcStartAlignment(),j.RightStart)),this.flyoutPosition&j.RightEnd&&e.push(this.calcRightPlacement(i,a,this.calcEndAlignment(o.height,i.height),j.RightEnd)),e}calcLeftPlacement(t,s,e,i){const n=new h(-t.width-s.width-this.actualDistance,e+this.actualOffset);return new B(i,n,o.Horizontal,!0,a.Near,r.bottom)}calcTopPlacement(t,s,e,i){const n=new h(e+this.actualOffset,-t.height-s.height-this.actualDistance);return new B(i,n,o.Vertical,!0,a.Near,r.top)}calcRightPlacement(t,s,e,i){const n=new h(t.width+s.width+this.actualDistance,e+this.actualOffset);return new B(i,n,o.Horizontal,!1,a.Far,r.bottom)}calcBottomPlacement(t,s,e,i){const n=new h(e+this.actualOffset,t.height+s.height+this.actualDistance);return new B(i,n,o.Vertical,!1,a.Near,r.bottom)}processBestTranslationResults(t,s,e,i,o,a,r,n,l){if(super.processBestTranslationResults(t,s,e,i,o,a,r,n,l),!this.dialog||!this.dialog.arrow)return;const h=this.calcArrowAlignment(a,r,n);this.dialog.arrowAlignment=h;const c=this.dialog.arrow;c.position=this.getArrowPosition(c,s,e,i,n,null==l?void 0:l.flyoutPosition),c.alignment=h}getArrowPosition(t,e,i,a,r,n){const l=r===o.Vertical,h=l?t.arrowSize.width:t.arrowSize.height,c=d.rectToRange(i,l),p=d.rectToRange(e,l),m=d.rectToRange(a,l);let u=p.start,f=p.end;this.fitToRestriction&&(p.start<=m.start?(u=m.start,f=u+p.size):p.end>=m.end&&(u=m.end-p.size,f=u+p.size));const[g,y]=[Math.max(u,c.start),Math.min(f,c.end)];let b;b=n&(j.RightStart|j.RightEnd|j.LeftStart|j.LeftEnd)?c.start:c.start+c.size/2;const w=this.alignWithinBoundaries(b-h/2,g,y),C=this.calculateArrowOffsetFromEdge(c,h,p);return l?new s(Math.min(Math.max(w-u,C),e.width-C-h),0):new s(0,Math.min(Math.max(w-f,C-e.height),-C-h))}calcArrowAlignment(t,s,e){return e===o.Vertical?s===r.bottom?P.bottom:P.top:t===a.Near?P.start:P.end}alignWithinBoundaries(t,s,e){return s>=e?(s+e)/2:Math.min(Math.max(t,s),e)}calculateArrowOffsetFromEdge(t,s,e){const i=Math.min(t.size-s,t.size/2-s/2);return Math.max(R.DefaultArrowOffsetFromEdge,Math.min(i,.2*e.size))}renderTemplate(){return C`
            <dxbl-branch
                id="branch"
                branch-id="${this.branchId}"
                parent-branch-id="${this.parentBranchId}"
                type="${l.Flyout}">
                <dxbl-flyout-root
                    id="root"
                    style="${this.rootCssStyle}">
                    ${this.renderDefaultSlot()}
                    ${this.renderBridgeSlot()}
                </dxbl-flyout-root>
            </dxbl-branch>
        `}renderDefaultSlot(){return C`<slot @slotchange="${this.slotChangedHandler}"></slot>`}handleSlotChange(t){const s=t.target.assignedNodes();this.dialog=s.find((t=>t instanceof x)),this.dialog&&(this.dialog.animationEnabled=this.animationEnabled),this.reposition()}updated(t){super.updated(t),this.dialog&&t.has("animationEnabled")&&(this.dialog.animationEnabled=this.animationEnabled)}};L.DefaultArrowOffsetFromEdge=8,t([S("#root",!0)],L.prototype,"root",void 0),t([g({type:Number,attribute:"flyout-position"})],L.prototype,"flyoutPosition",void 0),t([g({type:Number,attribute:"flyout-distance"})],L.prototype,"flyoutDistance",void 0),t([g({type:Number,attribute:"flyout-offset"})],L.prototype,"flyoutOffset",void 0),L=R=t([y("dxbl-flyout")],L);let D=class extends b{constructor(){super(...arguments),this.dropOpposite=!1,this.dropDirection=a.Near,this.dropAlignment=r.bottom}static get styles(){return w`
            :host {
                display: flex;
                flex: 1 1 auto;
                flex-direction: column;
                align-items: stretch;
                justify-items: stretch;
                min-height: 0;
            }
        }`}render(){return C`
            <slot></slot>
            <slot name="arrow"/>
        `}};t([g({type:Object,attribute:"drop-opposite"})],D.prototype,"dropOpposite",void 0),t([g({type:String,attribute:"drop-direction"})],D.prototype,"dropDirection",void 0),t([g({type:String,attribute:"drop-alignment"})],D.prototype,"dropAlignment",void 0),D=t([y("dxbl-flyout-root")],D);function M(t){if(!t)throw new Error("failed");return t}const z={getReference:M,registeredComponents:["dxbl-flyout","dxbl-flyout-dialog","dxbl-flyout-root",m,E,"dxbl-flyout-arrow"]};export{z as default,M as getReference};
