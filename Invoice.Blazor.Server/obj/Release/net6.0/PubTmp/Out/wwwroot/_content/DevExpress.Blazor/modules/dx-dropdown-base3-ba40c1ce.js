import{_ as e}from"./_tslib-6e8ca86b.js";import{i as o}from"./logicaltreehelper-15991dcb.js";import{P as n}from"./supportcaptureelement-51f73fdc.js";import{E as t}from"./eventhelper-8570b930.js";import{C as r}from"./custom-events-helper-18f7786a.js";import{d as s}from"./constants-4c28185b.js";import{P as i}from"./getPopupRootSingleton-f8347fe3.js";import{d as l,e as d}from"./popup-e5c1aca3.js";import{C as a}from"./css-classes-f3f8ed66.js";import{DxMaskedInputEditor as p}from"./masked-input-19562308.js";import{s as D}from"./lit-element-b0a6fcba.js";import{e as u}from"./property-d3853089.js";class h extends Event{constructor(){super(h.eventName,{bubbles:!0,composed:!0,cancelable:!0})}}h.eventName=s+".opendropdown";class c extends Event{constructor(){super(c.eventName,{bubbles:!0,composed:!0,cancelable:!0})}}c.eventName=s+".closedropdown",r.register(h.eventName,(e=>e.detail)),r.register(c.eventName,(e=>e.detail));class m{constructor(e){this.boundOnDropDownElementChangedHandler=this.onDropDownElementChanged.bind(this),this.boundOnDropDownShownHandler=this.onDropDownShown.bind(this),this.boundOnDropDownClosedHandler=this.onDropDownClosed.bind(this),this.boundOnDropDownPortalElementsChangedHandler=this.onDropDownPortalElementsChanged.bind(this),this.control=e,this.dropDownPortal=null,this._dropDownElement=null,this._adaptiveDropDownElement=null}get dropDownElement(){return this._dropDownElement}get useMobileFocusBehaviour(){var e;return(null===(e=this._adaptiveDropDownElement)||void 0===e?void 0:e.adaptivityEnabled)||!1}onConnectedCallback(){this.ensureDropDownInfrastructure(),this.control.addEventListener(i.eventName,this.boundOnDropDownElementChangedHandler)}onDisconnectedCallback(){this.control.removeEventListener(i.eventName,this.boundOnDropDownElementChangedHandler),this.disposeDropDownInfrastructure()}onSlotChanged(e){this.disposeDropDownInfrastructure(),this.ensureDropDownInfrastructure()}getDropDownPortal(){if(!this.control.shadowRoot)return null;const e=this.control.shadowRoot.querySelector("slot");if(!e)return null;return e.assignedNodes().find((e=>o(e,(()=>["popup","addEventListener","removeEventListener"]))))}onDropDownElementChanged(e){t.getOriginalSource(e)===this.dropDownPortal&&(this.disposeDropDownElement(),this.ensureDropDownElement())}onDropDownShown(e){this.dropDownElement&&o(this.dropDownElement,(()=>["logicalParent"]))&&this.control.addLogicalChild(this.dropDownElement)}onDropDownClosed(e){this.dropDownElement&&o(this.dropDownElement,(()=>["logicalParent"]))&&this.control.removeLogicalChild(this.dropDownElement)}onDropDownPortalElementsChanged(e){this.ensureDropDownElement()}ensureDropDownInfrastructure(){var e;this.dropDownPortal=this.getDropDownPortal(),null===(e=this.dropDownPortal)||void 0===e||e.addEventListener(i.eventName,this.boundOnDropDownPortalElementsChangedHandler),this.ensureDropDownElement()}ensureDropDownElement(){var e,n,t;this.dropDownPortal&&(this._dropDownElement=null===(e=this.dropDownPortal)||void 0===e?void 0:e.popup,null===(n=this._dropDownElement)||void 0===n||n.addEventListener(l.eventName,this.boundOnDropDownShownHandler),null===(t=this._dropDownElement)||void 0===t||t.addEventListener(d.eventName,this.boundOnDropDownClosedHandler),this._dropDownElement&&o(this._dropDownElement,(()=>["adaptivityEnabled"]))&&(this._adaptiveDropDownElement=this._dropDownElement),this.control.ensureDropDownElement())}disposeDropDownInfrastructure(){var e;null===(e=this.dropDownPortal)||void 0===e||e.removeEventListener(i.eventName,this.boundOnDropDownPortalElementsChangedHandler),this.dropDownPortal=null,this._adaptiveDropDownElement=null,this.disposeDropDownElement()}disposeDropDownElement(){var e,o;null===(e=this._dropDownElement)||void 0===e||e.removeEventListener(l.eventName,this.boundOnDropDownShownHandler),null===(o=this._dropDownElement)||void 0===o||o.removeEventListener(d.eventName,this.boundOnDropDownClosedHandler),this._dropDownElement=null,this.control.disposeDropDownElement()}}class w{}w.DropDownButton=a.Prefix+"-edit-btn-dropdown";class v extends p{constructor(){super(),this.boundOnClickHandler=this.onClick.bind(this),this.isDropDownOpen=!1,this.dropDownButtonElement=null,this.dropDownHelper=new m(this)}get useMobileFocusBehaviour(){return this.dropDownHelper.useMobileFocusBehaviour}get dropDownElement(){return this.dropDownHelper.dropDownElement}get shouldProcessFocusOut(){return!0}connectedCallback(){super.connectedCallback(),this.dropDownHelper.onConnectedCallback(),this.addEventListener("click",this.boundOnClickHandler)}disconnectedCallback(){this.removeEventListener("click",this.boundOnClickHandler),this.dropDownHelper.onDisconnectedCallback(),super.disconnectedCallback()}onSlotChanged(e){super.onSlotChanged(e),this.dropDownHelper.onSlotChanged(e),this.dropDownButtonElement=this.querySelector(`.${w.DropDownButton}`),o(this.inputElement,(()=>["logicalParent"]))&&this.addLogicalChild(this.inputElement)}processKeyDown(e){return this.isDropDownOpen||this.processKeyDownServerCommand(e),super.processKeyDown(e)}processFocusOut(e){var o,n,r;const s=t.getEventSource(e);if(null===(o=this.dropDownElement)||void 0===o?void 0:o.contains(s))return;const i=null!==(n=e.relatedTarget)&&void 0!==n?n:document.activeElement;this.contains(i)||(null===(r=this.dropDownElement)||void 0===r?void 0:r.contains(i))||this.raiseFocusOut(this.fieldElementValue)}processFocusIn(){this.focused&&super.processFocusIn()}onClick(e){var o,n;if(!t.containsInComposedPath(e,v.isClearButtonElement))return t.containsInComposedPath(e,v.isDropDownButtonElement)?(e.stopPropagation(),null===(n=this.inputElement)||void 0===n||n.focus(),void this.toggleDropDownVisibility()):void 0;null===(o=this.inputElement)||void 0===o||o.focus()}canHandlePointerDown(e){return n.containsInComposedPath(e,this.dropDownButtonElement)||n.containsInComposedPath(e,this.inputElement)}processKeyDownServerCommand(e){return!!v.isToggleDropDownVisibilityKeyCommand(e)&&(this.toggleDropDownVisibility(),!0)}ensureDropDownElement(){}disposeDropDownElement(){}toggleDropDownVisibility(){this.dispatchEvent(this.isDropDownOpen?new c:new h)}static isToggleDropDownVisibilityKeyCommand(e){return(e.altKey||e.metaKey)&&("ArrowUp"===e.key||"ArrowDown"===e.key)}static isDropDownButtonElement(e){var o;return!!e&&(null===(o=e.classList)||void 0===o?void 0:o.contains(w.DropDownButton))}processCapturedKeyDownAsync(e,o){return this.processKeyDownServerCommand(e)?(e.preventDefault(),o.handled=!0,Promise.resolve()):super.processCapturedKeyDownAsync(e,o)}async processCapturedPointerDownAsync(e,o){return this.canHandlePointerDown(e)?(o.handled=!0,Promise.resolve()):super.processCapturedPointerDownAsync(e,o)}}v.shadowRootOptions={...D.shadowRootOptions,delegatesFocus:!0},e([u({type:Boolean,attribute:"is-dropdown-open"})],v.prototype,"isDropDownOpen",void 0);export{v as D};
