import{E as t}from"./evt-e8379c08.js";import{T as e}from"./touch-f4b0b277.js";import{r,d as o}from"./disposable-d2c2d283.js";import{e as i,H as s}from"./dom-utils-7f5be2f0.js";import"./dom-166a04be.js";import"./_tslib-6e8ca86b.js";import"./css-classes-f3f8ed66.js";class n{static hsbToHtml(t){const e=this.hsbToRgb(t);return"rgb("+e.red+", "+e.green+", "+e.blue+")"}static hsbToRgb(t){const e=Math.floor(t.hue/60),r=(n.maxHsb.saturation-t.saturation)*t.brightness/n.maxHsb.brightness,o=t.hue%60*(t.brightness-r)/60,i=r+o,s=t.brightness-o;let a={red:0,green:0,blue:0};switch(e){case 0:a={red:t.brightness,green:i,blue:r};break;case 1:a={red:s,green:t.brightness,blue:r};break;case 2:a={red:r,green:t.brightness,blue:i};break;case 3:a={red:r,green:s,blue:t.brightness};break;case 4:a={red:i,green:r,blue:t.brightness};break;case 5:a={red:t.brightness,green:r,blue:s}}return a.red=Math.round(2.55*a.red),a.green=Math.round(2.55*a.green),a.blue=Math.round(2.55*a.blue),a}}n.maxHsb={hue:359,saturation:100,brightness:100};class a{constructor(t,e){this.currentColor=n.maxHsb,this._dotnetReference=e;const r=t.querySelector(".dx-blazor-colorpicker-hue-scale-wrapper"),o=t.querySelector(".dx-blazor-colorpicker-pallete");if(!r||!o)throw new Error("ColorAreas elements not found");this._hueArea=this.createHueArea(r,this),this._colorArea=this.createSaturationBrightnessArea(o,this)}updateColor(t){this.currentColor=t,this._hueArea.updateColor(t),this._colorArea.updateColor(t)}dispose(){this._colorArea.dispose(),this._hueArea.dispose()}createHueArea(t,e){if(this._hueArea)return this._hueArea;return new c(t,(t=>{e.currentColor.hue=t.hue,e._colorArea.updateBackground(e.currentColor);const r=n.hsbToRgb(e.currentColor);e._dotnetReference.invokeMethodAsync("OnColorChanged",r.red,r.green,r.blue)}))}createSaturationBrightnessArea(t,e){if(this._colorArea)return this._colorArea;return new u(t,(t=>{e.currentColor.saturation=t.saturation,e.currentColor.brightness=t.brightness;const r=n.hsbToRgb(e.currentColor);e._colorArea.indicator.style.backgroundColor="rgb("+r.red+", "+r.green+", "+r.blue+")",e._dotnetReference.invokeMethodAsync("OnColorChanged",r.red,r.green,r.blue)}))}}class h{constructor(t,e){this.onColorChanged=e,this.container=t,this.indicator=t.querySelector(this.getIndicatorCssCelector()),this._containerSize={width:this.container.offsetWidth,height:this.container.offsetHeight},this._indicatorSize={width:this.indicator.offsetWidth,height:this.indicator.offsetHeight},this.initializeEvents(this)}getIndicatorHeight(){return this._indicatorSize.height}getIndicatorWidth(){return this._indicatorSize.width}getContainerHeight(){return this._containerSize.height}getContainerWidth(){return this._containerSize.width}initializeEvents(o){const i=t=>{e.isTouchEvent(t)&&t.preventDefault(),document.addEventListener(e.touchMouseUpEventName,s),document.addEventListener(e.touchMouseMoveEventName,n),o.moveIndicator(t)},s=t=>{document.removeEventListener(e.touchMouseUpEventName,s),document.removeEventListener(e.touchMouseMoveEventName,n)},n=r=>{e.isTouchEvent(r)&&r.preventDefault(),t.isLeftButtonPressed(r)&&o.moveIndicator(r)};this.container.addEventListener(e.touchMouseDownEventName,i),r(this.container,(()=>{o.container.removeEventListener(e.touchMouseDownEventName,i),document.removeEventListener(e.touchMouseUpEventName,s),document.removeEventListener(e.touchMouseMoveEventName,n)}))}updateBackground(t){}dispose(){o(this.container)}}class c extends h{constructor(t,e){super(t,e)}getIndicatorCssCelector(){return".dx-blazor-colorpicker-hue-selection-rect"}moveIndicator(e){let r=s(t.getEventY(e),this.indicator,!1);r=Math.min(this.getContainerHeight()-Math.round(this.getIndicatorHeight()/2),Math.max(0-this.getIndicatorHeight()/2,r)),this.indicator.style.top=r+"px";const o={hue:this.getHueValue(r),saturation:n.maxHsb.saturation,brightness:n.maxHsb.brightness};this.indicator.style.backgroundColor=n.hsbToHtml(o),this.onColorChanged(o)}updateColor(t){this.indicator.style.top=this.calculateHueIndicatorPosition(t.hue)+"px",this.indicator.style.backgroundColor=n.hsbToHtml({hue:t.hue,saturation:n.maxHsb.saturation,brightness:n.maxHsb.brightness})}calculateHueIndicatorPosition(t){const e=this.getContainerHeight(),r=this.getIndicatorHeight();let o=e-e*t/n.maxHsb.hue;const i=Math.round(r/2);return o=Math.min(e-i,Math.max(0-r/2,o-i)),Math.round(o)}getHueValue(t){let e=(t+=t<0?this.getIndicatorHeight()/2:Math.round(this.getIndicatorHeight()/2))*n.maxHsb.hue/this.getContainerHeight();return e=n.maxHsb.hue-e,Math.round(e)}}class u extends h{constructor(t,e){super(t,e)}getIndicatorCssCelector(){return".dx-blazor-colorpicker-color-selection"}moveIndicator(e){let r=s(t.getEventX(e),this.indicator,!0),o=s(t.getEventY(e),this.indicator,!1);r=Math.min(this.getContainerWidth(),Math.max(0,r))-this.getIndicatorWidth()/2,o=Math.min(this.getContainerHeight(),Math.max(0,o))-this.getIndicatorHeight()/2,this.indicator.style.top=o+"px",this.indicator.style.left=r+"px";const i={hue:n.maxHsb.hue,saturation:this.getSaturationValue(r),brightness:this.getBrightnessValue(o)};this.onColorChanged(i)}updateColor(t){this.setIndicatorPosition(t),this.updateBackground(t)}updateBackground(t){this.container.style.backgroundColor=n.hsbToHtml({hue:t.hue,saturation:n.maxHsb.saturation,brightness:n.maxHsb.brightness}),this.indicator.style.backgroundColor=n.hsbToHtml(t)}setIndicatorPosition(t){this.indicator.style.left=this.convertSaturationToXCoordinate(t.saturation)+"px",this.indicator.style.top=this.convertBrightnessToYCoordinate(t.brightness)+"px"}convertSaturationToXCoordinate(t){const e=this.getContainerWidth()*t/n.maxHsb.saturation-this.getIndicatorWidth()/2;return Math.floor(e)}convertBrightnessToYCoordinate(t){const e=this.getContainerHeight(),r=e-e*t/n.maxHsb.brightness-this.getIndicatorHeight()/2;return Math.floor(r)}getSaturationValue(t){const e=(t+this.getIndicatorWidth()/2)*n.maxHsb.saturation/this.getContainerWidth();return Math.floor(e)}getBrightnessValue(t){const e=n.maxHsb.brightness-(t+this.getIndicatorHeight()/2)*n.maxHsb.brightness/this.getContainerHeight();return Math.floor(e)}}const d=new Map;function g(t,e,r){if(!(t=i(t)))return;let o=d.get(t);o||(o=new a(t,r),d.set(t,o)),o.updateColor(e)}function l(t,e){if(!(t=i(t)))return;const r=d.get(t);r&&r.updateColor(e)}function b(t){if(!(t=i(t)))return;const e=d.get(t);e&&(e.dispose(),d.delete(t))}const m={initialize:g,updateColor:l,dispose:b};export{m as default,b as dispose,g as initialize,l as updateColor};
