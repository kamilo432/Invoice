import{D as e}from"./dx-html-element-base-7f87ceb0.js";import{C as t}from"./css-classes-f3f8ed66.js";import{H as n,T as s,P as i,a as o,b as r,c as l}from"./dx-html-element-pointer-events-helper-0f2b6602.js";import{DxUIHandlersBridgeTagName as a}from"./dx-ui-handlers-bridge-4076ae57.js";import{B as d,D as h}from"./dom-166a04be.js";import{k as u}from"./key-59f0f3b5.js";import{S as c}from"./scroll-viewer-css-classes-af8d2aac.js";import{S as m}from"./svg-utils-0be6c8b2.js";import{T as g}from"./transformhelper-ebad0156.js";import{S as C,a as p}from"./dx-scroll-viewer-3d0ec9c1.js";import"./data-qa-utils-8be7c726.js";import"./eventhelper-8570b930.js";import"./_tslib-6e8ca86b.js";class b{}b.ClassName=t.Prefix+"-grid",b.DataTableClassName=b.ClassName+"-table",b.DataTableNoScrollClassName=b.DataTableClassName+"-no-scroll",b.GroupPanelContentContainerClassName=b.ClassName+"-group-panel-container",b.EmptyHeaderCellContentContainerClassName=b.ClassName+"-empty-header",b.GroupContentFreeSpaceClassName=b.ClassName+"-group-panel-free-space",b.HeaderRowClassName=b.ClassName+"-header-row",b.EditRowClassName=b.ClassName+"-edit-row",b.FilterRowClassName=b.ClassName+"-filter-row",b.GroupRowClassName=b.ClassName+"-group-row",b.FooterRowClassName=b.ClassName+"-footer-row",b.PagerRowClassName=b.ClassName+"-pager-row",b.HeaderElementClassName=b.ClassName+"-header",b.HeaderContentClassName=b.ClassName+"-header-content",b.AllowDragClassName=b.ClassName+"-action",b.DraggableHeaderClassName=b.ClassName+"-draggable-header",b.SelectionCellClassName=b.ClassName+"-selection-cell",b.CommandCellClassName=b.ClassName+"-command-cell",b.SelectedRowClassName=b.ClassName+"-selected-row",b.TouchSelectionClassName=b.ClassName+"-touch-selection",b.TouchSelectionEdgeClassName=b.ClassName+"-touch-selection-edge",b.MoveCursorCssClassName=b.ClassName+"-move-cursor",b.DraggingDownTargetClassName=b.ClassName+"-dragging-down-target",b.DraggingUpTargetClassName=b.ClassName+"-dragging-up-target",b.ColumnsResizeAnchorClassName=b.ClassName+"-column-resize-anchor",b.ColumnsSeparatorClassName=b.ClassName+"-columns-separator",b.HiddenEmptyCellClassName=b.ClassName+"-hidden-empty-cell",b.ColumnChooserItemClassName=b.ClassName+"-column-chooser-item",b.ColumnChooserDraggingItemClassName=b.ClassName+"-column-chooser-dragging-item",b.ColumnChooserDraggingItemNextSiblingClassName=b.ClassName+"-column-chooser-dragging-item-next-sibling",b.ColumnChooserItemDragAnchorClassName=b.ClassName+"-column-chooser-item-drag-anchor";class v{constructor(e,t,n,s,i=!1,o=!1,r=!1){this._uID=e,this._allowGroup=t,this._width=n,this._minWidth=s,this._isIndent=i,this._isEmpty=o,this._isDetail=r,this._firstRenderWidth=0,this._currentWidth=0,this._changedWidth=0}get uID(){return this._uID}get allowGroup(){return this._allowGroup}get minWidth(){return this._minWidth}get hasWidth(){return!!this._width}get isIndent(){return this._isIndent}get isEmpty(){return this._isEmpty}get isDetail(){return this._isDetail}get isFree(){return!this.width&&!this.isIndent&&!this.isEmpty}get isPercent(){return this.hasWidth&&-1!==this.width.indexOf("%")}get isFixed(){return this.hasWidth&&!this.isPercent}get width(){return this._width}set width(e){this._width=e}get firstRenderWidth(){return this._firstRenderWidth}set firstRenderWidth(e){this._firstRenderWidth=e}get currentWidth(){return this._currentWidth}set currentWidth(e){this._currentWidth=e}get changedWidth(){return this._changedWidth}set changedWidth(e){this._changedWidth=e}correctWidthByMinValue(){return this.currentWidth<this.minWidth&&(this.changedWidth=this.minWidth,!0)}distributeExcess(e){let t=this.currentWidth-e;return t<this.minWidth&&(t=this.minWidth),this.changedWidth=t,this.currentWidth-t}getPercents(){return this.isPercent?parseFloat(this.width.replace("%","")):0}}class f{constructor(e){this.columnsTotalPercents=0,this.columnsTotalPercentsWidth=0,this.columnsTotalFreeWidth=0,this.columnResizeController=e}initialize(){this.columnsTotalPercents=0,this.columnsTotalPercentsWidth=0,this.columnsTotalFreeWidth=0;for(let e=0;e<this.columnResizeController.columnsInfo.length;e++){const t=this.columnResizeController.columnsInfo[e],n=this.columnResizeController.getHeaderCellWidth(e);this.columnsTotalPercents+=t.getPercents(),t.isPercent?this.columnsTotalPercentsWidth+=n:t.isFree&&(this.columnsTotalFreeWidth+=n)}}getAllResizedColumns(e,t){const n=[];return this.calculateResizedColumns(n,e,t),t&&!n.includes(t.column)&&this.calculateResizedColumns(n,t,null),n}calculateResizedColumns(e,t,n){this.columnResizeController.isNextColumnResizeMode?t.column.isPercent?this.calculateResizedPercentColumns(e,t,n):t.column.isFree&&0===this.columnsTotalPercents?this.calculateResizedFreeColumns(e,t,n):this.calculateResizedColumn(e,t):this.calculateResizedColumn(e,t)}calculateResizedPercentColumns(e,t,n){if(null!==n&&n.column.isPercent)t.column.width=`${this.calculateNewPercent(t)}%`,n.column.width=`${this.calculateNewPercent(n)}%`,e.push(t.column,n.column);else{const n=this.calculateNewPercent(t);this.columnsTotalPercents<100===this.columnsTotalPercents-t.column.getPercents()+n<100?(t.column.width=`${n}%`,e.push(t.column)):this.calculateAllPercentColumns(e,t)}}calculateAllPercentColumns(e,t){const n=(this.columnsTotalPercentsWidth-t.initWidth+t.currentWidth)/this.columnsTotalPercents;for(let s=0;s<this.columnResizeController.columnsInfo.length;s++){const i=this.columnResizeController.columnsInfo[s],o=this.columnResizeController.getHeaderCellWidth(s);i.isPercent&&(i.width=i.uID===t.column.uID?t.currentWidth/n+"%":o/n+"%",e.push(i))}}calculateResizedFreeColumns(e,t,n){n&&n.column.isFree||(this.columnsTotalFreeWidth=this.columnsTotalFreeWidth-t.initWidth+t.currentWidth);for(let s=0;s<this.columnResizeController.columnsInfo.length;s++){const i=this.columnResizeController.columnsInfo[s],o=this.columnResizeController.getHeaderCellWidth(s);if(i.isFree){let s=o;i.uID===t.column.uID&&(s=t.currentWidth),i.uID===(null==n?void 0:n.column.uID)&&(s=n.currentWidth),i.width=100*s/this.columnsTotalFreeWidth+"%",e.push(i)}}}calculateResizedColumn(e,t){t.column.width=`${t.currentWidth}px`,e.push(t.column)}calculateNewPercent(e){return e.column.getPercents()*e.currentWidth/e.initWidth}}class E{constructor(e,t,n){this.column=e,this.currentWidth=t,this.initWidth=n}}var x;!function(e){e[e.Left=0]="Left",e[e.Right=1]="Right"}(x||(x={}));class S{constructor(e){this.columnIndex=-1,this.startMousePosition=-1,this.startElementPosition=-1,this.initWidth=-1,this.initNextWidth=-1,this.currentWidth=-1,this.currentNextWidth=-1,this.timeoutId=null,this.isColumnWidthsFixed=!1,this.fixedColumnWidths=new Map,this.columnWidthsBeforeFixed=new Map,this.boundOnDocumentMouseMoveHandler=this.onDocumentMouseMove.bind(this),this.grid=e,this.columnsCalculator=new f(this)}get columnsInfo(){return this.grid.columnsInfo}get isNextColumnResizeMode(){return this.grid.isNextColumnResizeMode}get moveStep(){const e=Math.ceil((this.initWidth+(this.isNextColumnResizeMode?this.initNextWidth:this.initWidth))/100);return Math.min(e,5)}get columnInfo(){return this.columnsInfo[this.columnIndex]}get nextColumnInfo(){return this.columnsInfo[this.columnIndex+1]}initialize(){this.columnResizeSeparator=this.grid.getColumnResizeSeparator()}isDragStarted(){return this.startMousePosition>-1}isFocused(){return-1!==this.columnIndex}focus(e){this.initializeResizing(e),this.needToFixColumnWidthsInPixels()&&this.fixColumnWidthsInPixels()}unfocus(){this.finalizeResizing()}startDrag(e,n){this.initializeResizing(e),this.startMousePosition=n,this.startElementPosition=this.getHeaderCellPosition(this.columnIndex),document.addEventListener("pointermove",this.boundOnDocumentMouseMoveHandler),document.body.classList.add(t.ResizeCursor),this.needToFixColumnWidthsInPixels()&&this.fixColumnWidthsInPixels()}stopDrag(){const e=new E(this.columnInfo,this.currentWidth,this.initWidth),t=this.isNextColumnResizeMode?new E(this.nextColumnInfo,this.currentNextWidth,this.initNextWidth):null;this.notifyColumnWidthsChanged(e,t),this.finalizeDragging()}cancelDrag(){this.cancelResize(),this.finalizeDragging()}resizeByMousePosition(e){const t=this.getHeaderCellPosition(this.columnIndex);this.resize(e-this.startMousePosition+this.startElementPosition-t)}performMoveStep(e){if(this.isDragStarted())return;let t=e===x.Right?this.moveStep:-this.moveStep;t+=this.currentWidth-this.initWidth,this.resize(t),this.timeoutId&&clearTimeout(this.timeoutId)}stopMove(){const e=new E(this.columnInfo,this.currentWidth,this.initWidth),t=this.isNextColumnResizeMode?new E(this.nextColumnInfo,this.currentNextWidth,this.initNextWidth):null;this.timeoutId=setTimeout((()=>this.notifyColumnWidthsChanged(e,t)),500)}getHeaderCellWidth(e){const t=this.getHeaderCell(e);return t&&t.getBoundingClientRect().width||0}onDocumentMouseMove(e){this.resizeByMousePosition(e.pageX)}initializeResizing(e){var t;this.columnIndex=e,this.initializeWidths();const n=this.getHeaderCell(e);n&&(null===(t=this.columnResizeSeparator)||void 0===t||t.show(n))}finalizeResizing(){var e;null===(e=this.columnResizeSeparator)||void 0===e||e.hide(),this.columnIndex=-1,this.clearWidths()}finalizeDragging(){this.startMousePosition=-1,this.startElementPosition=-1,document.removeEventListener("pointermove",this.boundOnDocumentMouseMoveHandler),document.body.classList.remove(t.ResizeCursor),this.finalizeResizing()}initializeWidths(){this.initWidth=this.currentWidth=this.getHeaderCellWidth(this.columnIndex),this.isNextColumnResizeMode&&(this.initNextWidth=this.getHeaderCellWidth(this.columnIndex+1)),this.columnsCalculator.initialize()}clearWidths(){this.initWidth=-1,this.initNextWidth=-1,this.currentWidth=-1,this.currentNextWidth=-1}fixColumnWidthsInPixels(){this.columnWidthsBeforeFixed.clear();const e=this.grid.getColElements();for(let t=0;t<this.grid.columnsInfo.length;t++){const n=this.grid.columnsInfo[t];this.allowResize(n)&&!n.isFixed?(this.fixedColumnWidths.set(t,`${this.getHeaderCellWidth(t)}px`),this.columnWidthsBeforeFixed.set(t,e[t].style.width)):this.fixedColumnWidths.delete(t)}this.fixedColumnWidths.forEach(((t,n)=>{e[n].style.width=t})),this.toggleEmptyColumnVisibility(!0,e)}resize(e){var t;const n=this.getNewWidth(e);n!==this.currentWidth&&(this.currentWidth=n,this.isNextColumnResizeMode&&(this.currentNextWidth=this.initWidth+this.initNextWidth-n),requestAnimationFrame((()=>this.updateColElements(`${this.currentWidth}px`,`${this.currentNextWidth}px`))),null===(t=this.columnResizeSeparator)||void 0===t||t.render())}cancelResize(){if(this.updateColElements(this.columnInfo.width,this.nextColumnInfo.width),!this.isNextColumnResizeMode&&!this.isColumnWidthsFixed){const e=this.grid.getColElements();this.columnWidthsBeforeFixed.forEach(((t,n)=>{e[n].style.width=t})),this.toggleEmptyColumnVisibility(!1,e)}}toggleEmptyColumnVisibility(e,t){if(this.grid.columnsInfo[this.grid.columnsInfo.length-1].isEmpty){const n=t[t.length-1];e?n.classList.remove(b.HiddenEmptyCellClassName):n.classList.add(b.HiddenEmptyCellClassName)}}getNewWidth(e){const t=this.initWidth+e;if(t<this.columnInfo.minWidth)return this.columnInfo.minWidth;if(this.isNextColumnResizeMode){const e=this.initWidth+this.initNextWidth-this.nextColumnInfo.minWidth;if(t>e)return e}return t}updateColElements(e,t){const n=this.getColElement(this.columnIndex),s=this.isNextColumnResizeMode?this.getColElement(this.columnIndex+1):null;n&&(n.style.width=e),s&&(s.style.width=t)}notifyColumnWidthsChanged(e,t){let n=this.columnsCalculator.getAllResizedColumns(e,t);this.isNextColumnResizeMode||this.isColumnWidthsFixed||(n=n.concat(this.getFixedColumns(e)));const s=n.map((e=>e.uID)),i=n.map((e=>e.width));this.grid.onColumnWidthsChanged(s,i),this.isNextColumnResizeMode||(this.isColumnWidthsFixed=!0)}getFixedColumns(e){const t=[];return this.fixedColumnWidths.forEach(((n,s)=>{const i=this.grid.columnsInfo[s];i.uID!==e.column.uID&&(i.width=n,t.push(i))})),t}getHeaderCell(e){const t=this.grid.getHeaderRow();return t?t.cells.item(e):null}getHeaderCellPosition(e){const t=this.getHeaderCell(e);return t&&t.getBoundingClientRect().x||0}getColElement(e){return this.grid.getColElements()[e]}needToFixColumnWidthsInPixels(){return!this.isNextColumnResizeMode&&!this.isColumnWidthsFixed}allowResize(e){return!e.isIndent&&!e.isEmpty}}class w extends e{constructor(){super(),this.cell=null,this.parentWidth=0,this.tableContainerResizeObserver=new ResizeObserver(this.onTableContainerSizeChanged.bind(this)),this.boundOnTableContainerScroll=this.onTableContainerScroll.bind(this)}get tableContainer(){return this._tableContainer}initializeComponent(){super.initializeComponent(),this.initializeTableContainer(),this.tableContainer.addEventListener("scroll",this.boundOnTableContainerScroll),this.tableContainerResizeObserver.observe(this.tableContainer)}initializeTableContainer(){this._tableContainer=this.closest(`.${c.ContentContainerClassName}`)}disposeComponent(){super.disposeComponent(),this.tableContainer.removeEventListener("scroll",this.boundOnTableContainerScroll),this.tableContainerResizeObserver.unobserve(this.tableContainer)}show(e){this.cell=e,this.classList.add(w.ActiveColumnResizeSeparator),this.render()}hide(){this.cell=null,this.classList.remove(w.ActiveColumnResizeSeparator),this.style.transform="none"}render(){requestAnimationFrame((()=>{if(!this.cell)return;const e=this.getColumnSeparatorPosition(this.cell),t=this.getBorderWidth(this.cell),n=w.getCenteredByBorderPosition(e,this.offsetWidth,t),s=this.getActualHeight();this.style.transform=`translateX(${n})`,s>0&&(this.style.height=`${s}px`)}))}onTableContainerScroll(){this.render()}onTableContainerSizeChanged(e){const t=e[0].contentRect.width;this.parentWidth!==t&&(this.parentWidth=t,this.render())}getColumnSeparatorPosition(e){return e.offsetLeft+e.offsetWidth-this.tableContainer.scrollLeft}getActualHeight(){const e=this.tableContainer.querySelector(`.${b.DataTableClassName} > tfoot`);if(!e)return 0;const t=e.getBoundingClientRect().height;return this.tableContainer.getBoundingClientRect().height-t}getBorderWidth(e){var t;const n=w.getBorderWidthByElement(e,"border-right-width");if(n>0)return n;const s=null===(t=this.cell)||void 0===t?void 0:t.nextElementSibling;return s&&w.getBorderWidthByElement(s,"border-left-width")}static getBorderWidthByElement(e,t){const n=getComputedStyle(e),s=n.getPropertyValue(t);return parseFloat(s)||parseFloat(n.borderWidth)}static getCenteredByBorderPosition(e,t,n){return e-(t-n)/2+"px"}}var R;w.ActiveColumnResizeSeparator=t.Active,function(e){e[e.ItemMoving=0]="ItemMoving",e[e.Stop=1]="Stop",e[e.Cancel=2]="Cancel"}(R||(R={}));class I{constructor(e){this.boundOnDocumentMouseMoveHandler=this.onDocumentMouseMove.bind(this),this.reorderContext=null,this.reorderingCallback=e}start(e,t,n){const s=e.map((e=>e.getBoundingClientRect())),i=e.indexOf(t),o=t.parentElement,r=I.calculateReorderIntervals(s,i),l=I.findInterval(r,0);this.reorderContext={state:R.ItemMoving,startY:n.y,currentY:n.y,offsetParentStartY:I.calcOffsetParentY(o),offsetParent:o,draggingItemIndex:i,draggingItem:t,items:e,intervals:r,initialInterval:l,currentInterval:l},this.refreshUI(),document.addEventListener("pointermove",this.boundOnDocumentMouseMoveHandler)}stop(){this.end(R.Stop)}cancel(){this.end(R.Cancel)}end(e){null!=this.reorderContext&&(this.reorderContext.state=e,this.refreshUI(),document.removeEventListener("pointermove",this.boundOnDocumentMouseMoveHandler))}onDocumentMouseMove(e){null!=this.reorderContext&&(this.reorderContext.currentY=e.y,this.refreshUI())}refreshUI(){if(null==this.reorderContext)return;const e=this.reorderContext.offsetParentStartY-I.calcOffsetParentY(this.reorderContext.offsetParent),t=this.reorderContext.currentY-this.reorderContext.startY+e;let n=I.findInterval(this.reorderContext.intervals,t);this.reorderContext.state===R.Cancel&&(n=this.reorderContext.initialInterval),this.reorderContext.currentInterval=n,this.applyTransformations(t)}applyTransformations(e){requestAnimationFrame((()=>{if(null==this.reorderContext)return;const t=this.reorderContext.currentInterval;if(null==t)return;const n=this.reorderContext.state===R.ItemMoving&&e>=t.top&&e<=t.bottom;for(let s=0;s<t.transforms.length;s++){let i=t.transforms[s];s===this.reorderContext.draggingItemIndex&&n&&(i=e),this.reorderContext.items[s].style.transform="translate(0, "+i+"px)"}this.reorderingCallback(this.reorderContext.items,t.itemIndices,this.reorderContext.draggingItemIndex,this.reorderContext.state)}))}static calcOffsetParentY(e){return e.getBoundingClientRect().y-e.scrollTop}static calculateReorderIntervals(e,t){const n=I.calcIntervalBounds(e,t),s=Array.from(Array(e.length).keys());s.splice(t,1);const i=e[t].height,o=[];for(let e=0;e<n.length;e++){const r=Array.from(s);r.splice(e,0,t),o.push({top:n[e].top,bottom:n[e].bottom,itemIndices:r,transforms:this.calcItemsTransformations(r,i)})}return o}static calcIntervalBounds(e,t){const n=Array.from(Array(e.length).keys()),s=0!==t?n.slice(0,t).reverse():[],i=t!==n.length-1?n.slice(t+1):[],o=this.calcIntervalBoundsCore(e,s),r=this.calcIntervalBoundsCore(e,i),l=[];o.reverse();for(let e=0;e<o.length;e++){const t=o[e];l.push({top:-1*t.bottom,bottom:-1*t.top})}return l.push({top:l.length>0?l[l.length-1].bottom+1:0,bottom:r.length>0?r[0].top-1:0}),l.concat(r)}static calcIntervalBoundsCore(e,t){if(0===t.length)return[];let n=0;const s=[];for(let i=0;i<t.length;i++){const o=e[t[i]].height;s.push(n+Math.ceil(o/2)),n+=o}s.push(n);const i=[];for(let e=0;e<s.length-1;e++)i.push({top:1+s[e],bottom:s[e+1]});return i}static calcItemsTransformations(e,t){const n=[];for(let s=0;s<e.length;s++){let i=0;const o=e.indexOf(s)-s;0!==o&&(i=t*o),n.push(i)}return n}static findInterval(e,t){for(let n=0;n<e.length;n++)if(t>=e[n].top&&t<=e[n].bottom)return e[n];return t<e[0].top?e[0]:t>e[e.length-1].bottom?e[e.length-1]:null}}var y,H,P;!function(e){e[e.Left=0]="Left",e[e.Right=1]="Right"}(y||(y={}));class D{constructor(){this.downTargetElement=D.addTargetToDom(b.DraggingDownTargetClassName,m.ArrowDownIconName),this.upTargetElement=D.addTargetToDom(b.DraggingUpTargetClassName,m.ArrowUpIconName);const e=this.upTargetElement.getBoundingClientRect();this.targetElementSize={width:e.width,height:e.height},this.upTargetElementPosition=null,this.downTargetElementPosition=null,this.hide()}show(){this.upTargetElementPosition&&this.downTargetElementPosition&&(this.downTargetElement.style.transform=g.translateByPoint(this.downTargetElementPosition),this.upTargetElement.style.transform=g.translateByPoint(this.upTargetElementPosition),this.downTargetElement.classList.remove(t.DisplayNone),this.upTargetElement.classList.remove(t.DisplayNone))}hide(){this.downTargetElement.classList.add(t.DisplayNone),this.upTargetElement.classList.add(t.DisplayNone)}setPositionRelativeToElement(e,t){this.setUpTargetPosition(e,t),this.setDownTargetPosition(e,t)}setUpTargetPosition(e,t){this.upTargetElementPosition={x:this.getTargetXCoordinate(e,t),y:e.y+e.height}}setDownTargetPosition(e,t){this.downTargetElementPosition={x:this.getTargetXCoordinate(e,t),y:e.y-this.targetElementSize.height}}getTargetXCoordinate(e,t){let n=e.x-this.targetElementSize.width/2;return t===y.Right&&(n+=e.width),n}dispose(){D.removeElementsByClassName(b.DraggingDownTargetClassName),D.removeElementsByClassName(b.DraggingUpTargetClassName)}static removeElementsByClassName(e){const t=document.querySelectorAll(`.${e}`);for(let e=0;e<t.length;e++)t[e].remove()}static addTargetToDom(e,t){const n=document.createElement("div");return n.className=e,n.innerHTML=m.getSvgHtml(t),document.body.appendChild(n),n}}!function(e){e[e.Header=0]="Header",e[e.GroupPanel=1]="GroupPanel",e[e.ColumnChooser=2]="ColumnChooser"}(H||(H={}));class N{constructor(e){this.boundOnDocumentMouseMoveHandler=this.onDocumentMouseMove.bind(this),this.boundOnDocumentScrollHandler=this.onDocumentScroll.bind(this),this.boundOnHeaderMouseMoveHandler=this.onHeaderMouseMove.bind(this),this.boundOnElementMouseOutHandler=this.onElementMouseOut.bind(this),this.boundOnGroupPanelMouseMoveHandler=this.onGroupPanelMouseMove.bind(this),this.boundOnEmptyHeaderCellMouseMoveHandler=this.onEmptyHeaderCellMouseMove.bind(this),this.boundOnGroupFreeSpaceMouseMoveHandler=this.onGroupFreeSpaceMouseMove.bind(this),this.draggableContext=null,this.isRefreshUIRequested=!1,this.grid=e}start(e,t){const n=N.addDraggableHeaderToDOM(e);this.draggableContext=this.createDraggableContext(e,n,t),this.addEventSubscriptions(),this.updateDraggableElement(t)}stop(){var e;this.isRefreshUIRequested=!1,null===(e=this.draggableContext)||void 0===e||e.targets.dispose(),this.draggableContext=null,N.removeDraggableHeaderFromDom(),this.removeEventSubscriptions(),document.body.classList.remove(b.MoveCursorCssClassName)}isStarted(){return!!this.draggableContext}updateDraggableContextByEvent(e){const t=document.elementFromPoint(e.clientX,e.clientY);this.updateDraggableContextByElement(t,e)}onDocumentMouseMove(e){this.updateDraggableElement(e)}onDocumentScroll(e){this.draggableContext&&(this.draggableContext.currentScrollPosition=N.getDocumentScrollPosition(),this.draggableContext.srcHeaderPosition=N.getElementPosition(this.draggableContext.srcHeaderElement),this.draggableContext.mouseOverElement&&this.setMouseOverElementInfo(this.draggableContext.mouseOverElement),this.updateDraggableElementPosition(),this.refreshUI())}onHeaderMouseMove(e){this.updateDraggableContextByElement(e.target,e)}onElementMouseOut(e){this.clearMoveStateFromDraggableContext(),this.refreshUI()}onGroupPanelMouseMove(){const e=this.grid.getGroupPanelContentContainer();this.onPanelElementMouseMove(e,H.GroupPanel)}onEmptyHeaderCellMouseMove(){const e=this.grid.getEmptyHeaderCellContentContainer();this.onPanelElementMouseMove(e,H.Header)}onGroupFreeSpaceMouseMove(){const e=this.grid.getGroupContentFreeSpaceElement();this.onPanelElementMouseMove(e,H.GroupPanel)}updateDraggableElement(e){this.draggableContext&&(this.draggableContext.currentCursorPosition={x:e.pageX,y:e.pageY},this.draggableContext.initialScrollPosition=this.draggableContext.currentScrollPosition,this.updateDraggableElementPosition(),this.refreshUI())}onPanelElementMouseMove(e,t){e&&this.draggableContext&&this.draggableContext.mouseOverElement!==e&&this.draggableContext.srcHeaderElement!==e.previousElementSibling&&(this.clearMoveStateFromDraggableContext(),this.setMouseOverElementInfo(e),this.draggableContext.dropArea=t,this.isPossibleDropToCurrentArea()&&(this.draggableContext.isPossibleDropColumn=!0,this.draggableContext.targets.setPositionRelativeToElement(this.draggableContext.mouseOverElementRect,y.Left)),this.refreshUI())}isPossibleDropToCurrentArea(){var e,t,n;return(null===(e=this.draggableContext)||void 0===e?void 0:e.allowGroup)||(null===(t=this.draggableContext)||void 0===t?void 0:t.dropArea)===(null===(n=this.draggableContext)||void 0===n?void 0:n.srcArea)}createColumnDraggedHandlerArgs(){if(!this.draggableContext||!this.draggableContext.isPossibleDropColumn)return null;const e=this.draggableContext;return{columnUid:e.columnUid,beforeColumnUid:e.beforeColumnUid,dropArea:e.dropArea}}updateDraggableContextByElement(e,t){const n=this.grid.findHeaderElement(e);n&&(this.updateDraggableContext(n,t),this.refreshUI())}updateDraggableContext(e,t){if(this.clearMoveStateFromDraggableContext(),null!=this.draggableContext&&this.draggableContext.srcHeaderElement!==e&&(this.setMouseOverElementInfo(e),this.isPossibleDropToCurrentArea())){const n=this.isThereCursorInLeftPart(t);if(n&&e.previousElementSibling!==this.draggableContext.srcHeaderElement&&(this.draggableContext.beforeColumnUid=this.grid.getColumnUID(e),this.draggableContext.isPossibleDropColumn=!0),!n&&e.nextElementSibling!==this.draggableContext.srcHeaderElement){const t=e.nextElementSibling;t&&(this.draggableContext.beforeColumnUid=this.grid.getColumnUID(t)),this.draggableContext.isPossibleDropColumn=!0}this.draggableContext.isPossibleDropColumn&&this.draggableContext.targets.setPositionRelativeToElement(this.draggableContext.mouseOverElementRect,n?y.Left:y.Right)}}getDropColumnArea(e){const t=this.grid.getGroupPanelContentContainer();return t&&N.isThereHeaderInsideGroupPanel(t,e)?H.GroupPanel:H.Header}static isThereHeaderInsideGroupPanel(e,t){const n=e.childNodes.length;for(let s=0;s<n;s++)if(e.childNodes[s]===t)return!0;return!1}refreshUI(){this.isRefreshUIRequested||(this.isRefreshUIRequested=!0,requestAnimationFrame((()=>{this.isRefreshUIRequested=!1;const e=this.draggableContext;e&&(e.headerElement.style.transform=`translate(${Math.round(e.draggableElementPosition.x)}px, ${Math.round(e.draggableElementPosition.y)}px)`,e.headerElement.classList.add("visible"),e.isPossibleDropColumn?e.targets.show():e.targets.hide(),document.body.classList.add(b.MoveCursorCssClassName))})))}setMouseOverElementInfo(e){if(!this.draggableContext)return;this.draggableContext.mouseOverElement=e;const t=e.getBoundingClientRect();if(this.draggableContext.mouseOverElementRect={x:t.left+this.draggableContext.currentScrollPosition.x,y:t.top+this.draggableContext.currentScrollPosition.y,width:t.width,height:t.height},this.draggableContext.scrollViewerRect){const e=this.draggableContext.scrollViewerRect;this.draggableContext.mouseOverElementRect.x<e.x&&(this.draggableContext.mouseOverElementRect.x=e.x),this.draggableContext.mouseOverElementRect.x+this.draggableContext.mouseOverElementRect.width>e.x+e.width&&(this.draggableContext.mouseOverElementRect.width=e.x+e.width-this.draggableContext.mouseOverElementRect.x)}this.draggableContext.dropArea=this.getDropColumnArea(e)}isThereCursorInLeftPart(e){if(!this.draggableContext||!this.draggableContext.mouseOverElementRect)return!1;const t=this.draggableContext.mouseOverElementRect;return e.pageX<t.x+t.width/2}updateDraggableElementPosition(){if(!this.draggableContext)return;const e=this.draggableContext;e.draggableElementPosition={x:e.srcHeaderPosition.x+(e.currentCursorPosition.x-e.initialCursorPosition.x)+(e.currentScrollPosition.x-e.initialScrollPosition.x)+e.currentScrollPosition.x,y:e.srcHeaderPosition.y+(e.currentCursorPosition.y-e.initialCursorPosition.y)+(e.currentScrollPosition.y-e.initialScrollPosition.y)+e.currentScrollPosition.y}}addEventSubscriptions(){document.addEventListener("pointermove",this.boundOnDocumentMouseMoveHandler),document.addEventListener("scroll",this.boundOnDocumentScrollHandler),this.addHeaderEventSubscriptions(),this.addGroupPanelEventSubscriptions(),this.addEmptyHeaderCellEventSubscriptions(),this.addGroupContentFreeSpaceElementEventSubscriptions()}addHeaderEventSubscriptions(){const e=this.grid.getHeaderCells();for(let t=0;t<e.length;t++){const n=e[t];n.addEventListener("pointermove",this.boundOnHeaderMouseMoveHandler),n.addEventListener("pointerout",this.boundOnElementMouseOutHandler)}}addEmptyHeaderCellEventSubscriptions(){const e=this.grid.getEmptyHeaderCellContentContainer();e&&this.addPanelElementEventSubscriptions(e,this.boundOnEmptyHeaderCellMouseMoveHandler)}addGroupPanelEventSubscriptions(){if(!this.shouldAddEventListenersToGroupPanel())return;const e=this.grid.getGroupPanelContentContainer();this.addPanelElementEventSubscriptions(e,this.boundOnGroupPanelMouseMoveHandler)}addGroupContentFreeSpaceElementEventSubscriptions(){const e=this.grid.getGroupContentFreeSpaceElement();e&&this.addPanelElementEventSubscriptions(e,this.boundOnGroupFreeSpaceMouseMoveHandler)}addPanelElementEventSubscriptions(e,t){e.addEventListener("pointermove",t),e.addEventListener("pointerout",this.boundOnElementMouseOutHandler)}removeEventSubscriptions(){document.removeEventListener("pointermove",this.boundOnDocumentMouseMoveHandler),document.removeEventListener("scroll",this.boundOnDocumentScrollHandler),this.removeHeaderEventSubscriptions(),this.removeGroupPanelEventSubscriptions(),this.removeEmptyHeaderCellEventSubscriptions(),this.removeGroupContentFreeSpaceElementEventSubscriptions()}removeHeaderEventSubscriptions(){const e=this.grid.getHeaderCells();for(let t=0;t<e.length;t++){const n=e[t];n.removeEventListener("pointermove",this.boundOnHeaderMouseMoveHandler),n.removeEventListener("pointerout",this.boundOnElementMouseOutHandler)}}removeGroupPanelEventSubscriptions(){if(!this.shouldAddEventListenersToGroupPanel())return;const e=this.grid.getGroupPanelContentContainer();this.removePanelElementEventSubscriptions(e,this.boundOnGroupPanelMouseMoveHandler)}removeEmptyHeaderCellEventSubscriptions(){const e=this.grid.getEmptyHeaderCellContentContainer();e&&this.removePanelElementEventSubscriptions(e,this.boundOnEmptyHeaderCellMouseMoveHandler)}removeGroupContentFreeSpaceElementEventSubscriptions(){const e=this.grid.getGroupContentFreeSpaceElement();e&&this.removePanelElementEventSubscriptions(e,this.boundOnGroupFreeSpaceMouseMoveHandler)}removePanelElementEventSubscriptions(e,t){e.removeEventListener("pointermove",t),e.removeEventListener("pointerout",this.boundOnElementMouseOutHandler)}shouldAddEventListenersToGroupPanel(){const e=this.grid.getGroupPanelContentContainer();return!!e&&!(null==e?void 0:e.querySelector(`.${b.HeaderElementClassName}`))}static addDraggableHeaderToDOM(e){const t=document.createElement("div");t.className=`${b.DraggableHeaderClassName}`,e.classList.contains(b.SelectionCellClassName)&&t.classList.add(b.SelectionCellClassName),e.classList.contains(b.CommandCellClassName)&&t.classList.add(b.CommandCellClassName);const n=e.getBoundingClientRect();t.style.width=`${n.width}px`,t.style.height=`${n.height}px`;const s=getComputedStyle(e);t.style.padding=s.padding,t.style.font=s.font;const i=this.getContentElement(e).cloneNode(!0);return t.appendChild(i),document.body.appendChild(t),t}static getContentElement(e){return e.querySelector(`.${b.HeaderContentClassName}`)}static removeDraggableHeaderFromDom(){const e=document.querySelectorAll(`.${b.DraggableHeaderClassName}`);for(let t=0;t<e.length;t++)e[t].remove()}createDraggableContext(e,t,n){const s=N.getDocumentScrollPosition(),i=N.getPointerPosition(n),o=this.grid.getScrollViewer();return{srcHeaderPosition:N.getElementPosition(e),srcHeaderElement:e,headerElement:t,allowGroup:this.grid.canGroupByColumn(e),mouseOverElement:null,mouseOverElementRect:null,scrollViewerRect:o&&o.getRectangle(),isPossibleDropColumn:!1,columnUid:this.grid.getColumnUID(e),beforeColumnUid:null,srcArea:e.closest(`.${b.GroupPanelContentContainerClassName}`)?H.GroupPanel:H.Header,dropArea:H.Header,initialCursorPosition:i,currentCursorPosition:{x:0,y:0},draggableElementPosition:i,initialScrollPosition:s,currentScrollPosition:s,targets:new D}}clearMoveStateFromDraggableContext(){this.draggableContext&&(this.draggableContext.mouseOverElement=null,this.draggableContext.mouseOverElementRect=null,this.draggableContext.isPossibleDropColumn=!1,this.draggableContext.beforeColumnUid=null)}static getPointerPosition(e){return{x:e.pageX,y:e.pageY}}static getDocumentScrollPosition(){return{x:document.documentElement.scrollLeft,y:document.documentElement.scrollTop}}static getElementPosition(e){const{left:t,top:n}=e.getBoundingClientRect();return{x:t,y:n}}}class W{constructor(e){this._startSelectionRowIndex=-1,this._endSelectionRowIndex=-1,this.savedSelectedRows=[],this.boundOnRowPointerEnterHandler=this.onRowPointerEnter.bind(this),this.grid=e}get startSelectionRowIndex(){return this._startSelectionRowIndex}get endSelectionRowIndex(){return this._endSelectionRowIndex}start(e,t){this._startSelectionRowIndex=this.grid.getRowVisibleIndexByTarget(e),this._startSelectionRowIndex>-1&&(this._endSelectionRowIndex=this._startSelectionRowIndex,t&&this.storeSelectedRows(),this.addRowEventSubscriptions(),this.updateRowsSelection())}stop(){this._startSelectionRowIndex>-1&&(this.deselectRows(),this.removeRowEventSubscriptions(),this.restoreSelectedRows(),this._startSelectionRowIndex=-1,this._endSelectionRowIndex=-1)}isStarted(){return this._startSelectionRowIndex>-1&&this._endSelectionRowIndex>-1}updateSeletionByEvent(e){const t=document.elementFromPoint(e.clientX,e.clientY);this.updateSeletionByElement(t)}findRowElement(e){return this.grid.getMainElement().querySelector(`tr[data-visible-index="${e}"]`)}findRowElements(){return this.grid.getMainElement().querySelectorAll("tr[data-visible-index]")}findSelectedRowElements(){return this.grid.getMainElement().querySelectorAll(`tr.${b.SelectedRowClassName}[data-visible-index]`)}addRowEventSubscriptions(){const e=this.findRowElements();if(e)for(let t=0;t<e.length;t++)e[t].addEventListener("pointerenter",this.boundOnRowPointerEnterHandler)}removeRowEventSubscriptions(){const e=this.findRowElements();if(e)for(let t=0;t<e.length;t++)e[t].removeEventListener("pointerenter",this.boundOnRowPointerEnterHandler)}updateSeletionByElement(e){const t=this.grid.getRowVisibleIndexByTarget(e,!0);t>-1&&(this._endSelectionRowIndex=t,this.updateRowsSelection())}onRowPointerEnter(e){this.updateSeletionByElement(e.target)}selectRows(e){for(let t=0;t<e.length;t++){const n=this.findRowElement(e[t]);n&&n.classList.add(0===t||t===e.length-1?b.TouchSelectionEdgeClassName:b.TouchSelectionClassName)}}deselectRows(){const e=this.findRowElements();if(e)for(let t=0;t<e.length;t++)e[t].classList.remove(b.TouchSelectionClassName,b.TouchSelectionEdgeClassName)}updateRowsSelection(){if(-1===this.startSelectionRowIndex||-1===this.endSelectionRowIndex)return;this.deselectRows();const e=Math.min(this.startSelectionRowIndex,this.endSelectionRowIndex),t=Math.max(this.startSelectionRowIndex,this.endSelectionRowIndex),n=Array.from({length:t-e+1},((t,n)=>n+e));this.selectRows(n)}storeSelectedRows(){const e=this.findSelectedRowElements();if(e)for(let t=0;t<e.length;t++)e[t].classList.remove(b.SelectedRowClassName),this.savedSelectedRows.push(e[t])}restoreSelectedRows(){for(let e=0;e<this.savedSelectedRows.length;e++)this.savedSelectedRows[e].classList.add(b.SelectedRowClassName);this.savedSelectedRows=[]}}!function(e){e[e.ColumnsChanged=0]="ColumnsChanged",e[e.GridResize=1]="GridResize"}(P||(P={}));class M{constructor(e){this.grid=e,this.freeColumnIndices=[],this.percentColumnIndeces=[],this.totalAbsoluteWidth=0,this.totalPercentWidth=0,this.totalPercents=0,this.freeCoumnsCount=0,this.excess=0}get columnsInfo(){return this.grid.columnsInfo}correctWidths(e){return 0!==this.columnsInfo.length&&(requestAnimationFrame((()=>{const t=this.grid.getColElements();this.resetColumnWidths(t,e),this.collectInfo(e),this.distributeExcess(),this.applyChangedWidths(t,e)})),!0)}resetColumnWidths(e,t){for(let n=0;n<e.length;n++)n<this.columnsInfo.length&&!this.columnsInfo[n].isIndent&&!this.columnsInfo[n].isEmpty&&(this.columnsInfo[n].changedWidth=0,t===P.ColumnsChanged&&this.repairStyle(e[n],n))}collectInfo(e){this.clearInfo(e),e===P.ColumnsChanged&&this.getCurrentWidths(),e===P.GridResize&&this.calculateCurrentWidths();for(let e=0;e<this.columnsInfo.length;e++){const t=this.columnsInfo[e];t.isIndent||t.isEmpty||(t.correctWidthByMinValue()?this.excess+=t.changedWidth-t.currentWidth:(t.isFree&&this.freeColumnIndices.push(e),t.isPercent&&(this.totalPercentWidth+=t.currentWidth,this.percentColumnIndeces.push(e))))}}clearInfo(e){this.freeColumnIndices=[],this.percentColumnIndeces=[],this.totalPercentWidth=0,this.excess=0,e===P.ColumnsChanged&&(this.totalAbsoluteWidth=0,this.freeCoumnsCount=0,this.totalPercents=0)}getCurrentWidths(){const e=this.grid.getHeaderRow();if(!e)return;const t=e.cells;if(t.length&&!t[0].classList.contains(b.EmptyHeaderCellContentContainerClassName))for(let e=0;e<this.columnsInfo.length;e++){const n=this.columnsInfo[e];n.currentWidth=n.firstRenderWidth=t[e].getBoundingClientRect().width,n.isPercent?this.totalPercents+=n.getPercents():n.isFixed||n.isIndent?this.totalAbsoluteWidth+=n.firstRenderWidth:n.isFree&&(this.freeCoumnsCount+=1)}}calculateCurrentWidths(){const e=this.grid.getTableContainerWidth(),t=this.totalAbsoluteWidth;let n=e*this.totalPercents/100;n>e-t&&(n=Math.max(0,e-t));const s=Math.max(0,e-t-n);for(let e=0;e<this.columnsInfo.length;e++){const t=this.columnsInfo[e];t.isPercent?t.currentWidth=n*t.getPercents()/this.totalPercents:t.isFixed||t.isIndent?t.currentWidth=t.firstRenderWidth:t.isFree?t.currentWidth=s/this.freeCoumnsCount:t.isEmpty&&(t.currentWidth=s)}}distributeExcess(){if(this.excess>0){this.sortIndices(this.freeColumnIndices,0),this.distributeExcessToFreeColumns();const e=this.columnsInfo[this.columnsInfo.length-1];e.isEmpty&&(this.excess-=e.currentWidth),this.excess>0&&(this.sortIndices(this.percentColumnIndeces,this.excess/this.totalPercentWidth),this.distributeExcessToPercentColumns())}}sortIndices(e,t){e.sort(((e,n)=>{const s=this.columnsInfo[e],i=this.columnsInfo[n];return i.currentWidth-i.minWidth-i.currentWidth*t-(s.currentWidth-s.minWidth-s.currentWidth*t)>0?-1:1}))}distributeExcessToFreeColumns(){for(let e=0;e<this.freeColumnIndices.length;e++){this.excess-=this.columnsInfo[this.freeColumnIndices[e]].distributeExcess(this.excess/(this.freeColumnIndices.length-e))}}distributeExcessToPercentColumns(){for(let e=0;e<this.percentColumnIndeces.length;e++){const t=this.columnsInfo[this.percentColumnIndeces[e]];this.excess-=t.distributeExcess(this.excess*t.currentWidth/this.totalPercentWidth),this.totalPercentWidth-=t.currentWidth}}applyChangedWidths(e,t){for(let n=0;n<this.columnsInfo.length;n++){const s=this.columnsInfo[n].changedWidth;s?e[n].style.width=`${s}px`:t===P.GridResize&&this.repairStyle(e[n],n)}}repairStyle(e,t){e.style.width=this.columnsInfo[t].hasWidth?this.columnsInfo[t].width:""}}const z=document.createElement("template");z.innerHTML="\n<style></style>\n<slot />";const T="dxbl-grid",O="data-dx-grid-uid";class L extends e{constructor(){super(),this._columnsInfo=[],this._allowSelectRowByClick=!1,this._enableFocusedRow=!1,this._enableMultiSelect=!1,this._hasRowClickEvent=!1,this._hasRowDblClickEvent=!1,this._isNextColumnResizeMode=!1,this.boundOnDragStartHandler=this.onDragStart.bind(this),this.boundOnDragStopHandler=this.onDragStop.bind(this),this.boundOnDragCancelHandler=this.onDragCancel.bind(this),this.boundOnClickHandler=this.onClick.bind(this),this.boundOnScrollViewerUpdateHandler=this.onScrollViewerUpdate.bind(this),this.boundOnDocumentKeyDownHandler=this.onDocumentKeyDown.bind(this),this.boundOnPointerOverHandler=this.onPointerOver.bind(this),this.boundOnMouseDownHandler=this.onMouseDown.bind(this),this.currentWidth=-1,this.draggingHelper=new N(this),this.columnWidthsController=new M(this),this.columnResizeController=new S(this),this.selectionHelper=new W(this),this.resizeObserver=new ResizeObserver(this.onSizeChanged.bind(this)),this.isHoverableDevice=!1}initializeComponent(){super.initializeComponent(),this.isHoverableDevice=class{static isHoverableDevice(){return window.matchMedia("(hover: hover) and (pointer: fine)").matches}}.isHoverableDevice(),this.uiHandlersBridge=this.querySelector(a),this.columnResizeController.initialize(),this.addEventSubscriptions(),this.resizeObserver.observe(this)}disposeComponent(){this.removeEventSubscriptions(),this.resizeObserver.unobserve(this),delete this.uiHandlersBridge,super.disposeComponent()}getMainElement(){return this}getDataTable(){return this.querySelector(`.${b.DataTableClassName}`)}getHeaderRow(){return this.querySelector(`thead > tr.${b.HeaderRowClassName}`)}getFilterRow(){return this.querySelector(`thead > tr.${b.FilterRowClassName}`)}getHeaderCells(){return this.querySelectorAll(`.${b.HeaderElementClassName}`)}getGroupPanelContentContainer(){return this.querySelector(`.${b.GroupPanelContentContainerClassName}`)}getEmptyHeaderCellContentContainer(){return this.querySelector(`.${b.EmptyHeaderCellContentContainerClassName}`)}getGroupContentFreeSpaceElement(){return this.querySelector(`.${b.GroupContentFreeSpaceClassName}`)}getColElements(){return this.querySelectorAll("col")}getFooterRow(){return this.querySelector(`.${b.FooterRowClassName}`)}getPagerRow(){return this.querySelector(`.${b.PagerRowClassName}`)}getScrollViewer(){return this.querySelector(`.${c.ClassName}`)}getScrollViewerContent(){return this.querySelector(`.${c.ContentContainerClassName}`)}getTableContainerWidth(){const e=this.getScrollViewerContent();return e?null==e?void 0:e.getBoundingClientRect().width:0}getColumnResizeSeparator(){return this.querySelector(`.${b.ColumnsSeparatorClassName}`)}addEventSubscriptions(){this.addEventListener(i.eventName,this.boundOnDragStartHandler),this.addEventListener(o.eventName,this.boundOnDragStopHandler),this.addEventListener(r.eventName,this.boundOnDragCancelHandler),this.addEventListener(l.eventName,this.boundOnClickHandler),this.addEventListener(p.eventName,this.boundOnScrollViewerUpdateHandler),document.addEventListener("keydown",this.boundOnDocumentKeyDownHandler),this.isHoverableDevice&&this.addEventListener("pointerover",this.boundOnPointerOverHandler),d.Firefox&&this.addEventListener("mousedown",this.boundOnMouseDownHandler)}removeEventSubscriptions(){this.removeEventListener(i.eventName,this.boundOnDragStartHandler),this.removeEventListener(o.eventName,this.boundOnDragStopHandler),this.removeEventListener(r.eventName,this.boundOnDragCancelHandler),this.removeEventListener(l.eventName,this.boundOnClickHandler),this.removeEventListener(p.eventName,this.boundOnScrollViewerUpdateHandler),document.removeEventListener("keydown",this.boundOnDocumentKeyDownHandler),this.isHoverableDevice&&this.removeEventListener("pointerover",this.boundOnPointerOverHandler),d.Firefox&&this.removeEventListener("mousedown",this.boundOnMouseDownHandler)}onDragStart(e){var t,n,s;const i=e.target,o=e.detail.source;if(this.isResizeAnchor(i)){const e=this.findHeaderElement(i),n=this.getElementIndex(e);this.columnResizeController.startDrag(n,o.pageX),null===(t=this.getScrollViewer())||void 0===t||t.startAutoScrolling(C.Horizontal,(e=>this.columnResizeController.resizeByMousePosition(e.pageX)))}else if(this.isHeaderContentElement(i)){const e=this.findHeaderElement(i);e&&(this.draggingHelper.start(e,o),null===(n=this.getScrollViewer())||void 0===n||n.startAutoScrolling(C.Horizontal,(e=>this.draggingHelper.updateDraggableContextByEvent(e))))}else this.selectionHelper.start(o.target,!o.ctrlKey&&!o.metaKey&&!e.detail.isLongTap),null===(s=this.getScrollViewer())||void 0===s||s.startAutoScrolling(C.Vertical,(e=>this.selectionHelper.updateSeletionByEvent(e)),(e=>{const t=this.getDataTable();if(t){const n=t.querySelector("thead");n&&(e.y+=n.offsetHeight,e.height-=n.offsetHeight);const s=t.querySelector("tfoot");s&&(e.height-=s.offsetHeight)}}));e.stopPropagation()}onDragStop(e){var t;if(this.columnResizeController.isDragStarted())this.columnResizeController.stopDrag();else if(this.draggingHelper.isStarted())this.onColumnHeaderDragged(),this.draggingHelper.stop();else if(this.selectionHelper.isStarted()){if(this.uiHandlersBridge&&this.selectionHelper.startSelectionRowIndex>-1&&this.selectionHelper.endSelectionRowIndex>-1){this.uiHandlersBridge.send("rowDragged",{startVisibleIndex:this.selectionHelper.startSelectionRowIndex,endVisibleIndex:this.selectionHelper.endSelectionRowIndex,cleanSelection:!e.detail.source.ctrlKey&&!e.detail.source.metaKey&&!e.detail.isLongTap})}this.selectionHelper.stop()}null===(t=this.getScrollViewer())||void 0===t||t.stopAutoScrolling(),e.stopPropagation()}onDragCancel(e){var t;this.columnResizeController.isDragStarted()?this.columnResizeController.cancelDrag():this.draggingHelper.isStarted()?this.draggingHelper.stop():this.selectionHelper.isStarted()&&this.selectionHelper.stop(),null===(t=this.getScrollViewer())||void 0===t||t.stopAutoScrolling(),e.stopPropagation()}onClick(e){this.isResizeAnchor(e.target)&&e.detail.source.stopPropagation()}onScrollViewerUpdate(e){const t=this.getScrollViewerContent(),n=this.getDataTable();t&&n&&(n.offsetHeight<t.clientHeight?h.addClassName(n,b.DataTableNoScrollClassName):n.offsetHeight>t.clientHeight&&h.removeClassName(n,b.DataTableNoScrollClassName)),e.stopPropagation()}getRowVisibleIndexByTarget(e,t){let n=e;for(;n&&n!==this&&(t||!n.classList.contains(b.EditRowClassName));){if("tr"===n.tagName.toLowerCase()&&n.dataset.visibleIndex)return parseInt(n.dataset.visibleIndex);n=n.parentElement}return-1}get allowSelectRowByClick(){return this._allowSelectRowByClick}set allowSelectRowByClick(e){this._allowSelectRowByClick=e,this.updateHandlePointerEventsMode()}get enableMultiSelect(){return this._enableMultiSelect}set enableMultiSelect(e){this._enableMultiSelect=e,this.updateHandlePointerEventsMode()}get enableFocusedRow(){return this._enableFocusedRow}set enableFocusedRow(e){this._enableFocusedRow=e,this.updateHandlePointerEventsMode()}get hasRowClickEvent(){return this._hasRowClickEvent}set hasRowClickEvent(e){this._hasRowClickEvent=e,this.updateHandlePointerEventsMode()}get hasRowDblClickEvent(){return this._hasRowDblClickEvent}set hasRowDblClickEvent(e){this._hasRowDblClickEvent=e,this.updateHandlePointerEventsMode()}get isNextColumnResizeMode(){return this._isNextColumnResizeMode}set isNextColumnResizeMode(e){this._isNextColumnResizeMode=e}get columnsInfo(){return this._columnsInfo}updateHandlePointerEventsMode(){this.handlePointerEventsMode=n.None,(this.hasRowClickEvent||this.enableFocusedRow)&&(this.handlePointerEventsMode|=n.Click),this.hasRowDblClickEvent&&(this.handlePointerEventsMode|=n.DblClick),this.allowSelectRowByClick&&(this.handlePointerEventsMode|=n.Click,this.enableMultiSelect&&d.TouchUI&&(this.handlePointerEventsMode|=n.Dragging))}notifyColumnsInitialized(e){this._columnsInfo=e}notifyColumnsChanged(e){this._columnsInfo=e,this.correctWidths(P.ColumnsChanged)}notifyColumnResizeAnchorFocus(e){const t=this.findHeaderElement(e),n=this.getElementIndex(t);this.columnResizeController.focus(n)}notifyColumnResizeAnchorBlur(){this.columnResizeController.unfocus()}notifyColumnResizeAnchorMove(e){this.columnResizeController.performMoveStep(e)}notifyColumnResizeAnchorStopMove(){this.columnResizeController.stopMove()}correctWidths(e){if(this.columnResizeController.isDragStarted()||this.columnResizeController.isFocused())return;this.columnWidthsController.correctWidths(e);const t=this.getScrollViewer();t&&t.refreshUI&&t.refreshUI()}getElementIndex(e){if(!e)return-1;if(e instanceof HTMLTableCellElement)return e.cellIndex;if(e&&e.parentElement)for(let t=0;t<e.parentElement.children.length;t++)if(e.parentElement.children[t]===e)return t;return-1}getColumnsInfo(e){const t=this.findHeaderElement(e),n=this.getElementIndex(t);return 0<=n&&n<this.columnsInfo.length?this.columnsInfo[n]:null}getColumnUID(e){const t=this.getColumnsInfo(e);return t?t.uID:-1}canGroupByColumn(e){const t=this.getColumnsInfo(e);return!!t&&t.allowGroup}findHeaderElement(e){const t=e;return t?this.isHeaderElement(t)?t:t.closest(`.${b.HeaderElementClassName}`):null}isHeaderElement(e){return e&&e.classList.contains(b.HeaderElementClassName)}isHeaderContentElement(e){return"dxbl-grid-header-content"===e.tagName.toLowerCase()}isResizeAnchor(e){return e.classList.contains(b.ColumnsResizeAnchorClassName)}onDocumentKeyDown(e){if("Enter"===e.key||" "===e.key){const t=this.findHeaderElement(e.target);if(t){const n=new MouseEvent("click",{bubbles:!0,cancelable:!0,ctrlKey:e.ctrlKey,metaKey:e.metaKey,shiftKey:e.shiftKey});t.dispatchEvent(n)}}}onPointerOver(e){const t=e.target;this.requireProcessTruncatedElementTitle(t)&&(t.offsetWidth<t.scrollWidth?(t.setAttribute("title",t.innerText),t.setAttribute(L.TextTrimmedAttributeName,"")):(t.removeAttribute("title"),t.removeAttribute(L.TextTrimmedAttributeName)))}requireProcessTruncatedElementTitle(e){return!(!e||e.childElementCount>0)&&("INPUT"!==e.tagName&&"TEXTAREA"!==e.tagName&&!(e.getAttribute("title")&&!e.hasAttribute(L.TextTrimmedAttributeName)))}onMouseDown(e){e.ctrlKey&&e.preventDefault()}onColumnChooserItemDragged(e,t){this.onColumnDragged({columnUid:e,beforeColumnUid:t,dropArea:H.ColumnChooser})}onColumnHeaderDragged(){this.onColumnDragged(this.draggingHelper.createColumnDraggedHandlerArgs())}onColumnDragged(e){e&&this.uiHandlersBridge&&this.uiHandlersBridge.send("columnHeaderDragged",e)}onColumnWidthsChanged(e,t){this.uiHandlersBridge&&this.uiHandlersBridge.send("columnWidthsChanged",{columnUids:e,widths:t})}onSizeChanged(e){const t=e[0].contentRect.width;this.currentWidth!==t&&(this.correctWidths(-1===this.currentWidth?P.ColumnsChanged:P.GridResize),this.currentWidth=t)}getContentTemplate(){return z}static get observedAttributes(){return["allow-select-row-by-click","enable-multi-select","has-row-click-event","has-row-dbl-click-event","is-next-column-resize-mode","enable-focused-row"]}attributeChangedCallback(e,t,n){switch(e){case"allow-select-row-by-click":this.allowSelectRowByClick=null!==n;break;case"enable-focused-row":this.enableFocusedRow=null!==n;break;case"enable-multi-select":this.enableMultiSelect=null!==n;break;case"has-row-click-event":this.hasRowClickEvent=null!==n;break;case"has-row-dbl-click-event":this.hasRowDblClickEvent=null!==n;break;case"is-next-column-resize-mode":this.isNextColumnResizeMode=null!==n}}static findGrid(e){return document.querySelector(`dxbl-grid[${O}="${e}"]`)}}L.TextTrimmedAttributeName="text-trimmed",customElements.define("dxbl-grid",L),customElements.define("dxbl-grid-header-content",class extends e{constructor(){super(),this.handlePointerEventsMode=n.Click|n.Dragging}get handlePointerEventsTarget(){return this.closest(`.${b.HeaderElementClassName}`)}get handlePointerEventsDelay(){return s}}),customElements.define("dxbl-grid-columns-info",class extends e{constructor(){super()}get data(){return this.getAttribute("data")}get columns(){return null!==this.data?this.parseColumns(this.data):[]}initializeComponent(){super.initializeComponent(),this.grid=this.closest(`.${b.ClassName}`),this.grid.notifyColumnsInitialized(this.columns)}parseColumns(e){const t=JSON.parse(e),n=[];for(let e=0;e<t.length;e++){const s=new v(t[e].UID,t[e].AllowGroup,t[e].Width,t[e].MinWidth,t[e].IsIndent,t[e].IsEmpty,t[e].IsDetail);n.push(s)}return n}static get observedAttributes(){return["data"]}attributeChangedCallback(e,t,n){var s;null===(s=this.grid)||void 0===s||s.notifyColumnsChanged(this.parseColumns(n))}}),customElements.define("dxbl-column-resize-anchor",class extends e{constructor(){super(),this.boundOnAnchorFocusHandler=this.onAnchorFocus.bind(this),this.boundOnAnchorBlurHandler=this.onAnchorBlur.bind(this),this.boundOnKeyDownHandler=this.onKeyDown.bind(this),this.boundOnKeyUpHandler=this.onKeyUp.bind(this),this.handlePointerEventsMode=n.Click|n.Dragging}get handlePointerEventsDelay(){return s}initializeComponent(){var e,n,s,i;super.initializeComponent(),d.TouchUI&&this.classList.add(t.Touch),this.grid=this.closest(`.${b.ClassName}`),this.focusableElement=this.querySelector("div"),null===(e=this.focusableElement)||void 0===e||e.addEventListener("focus",this.boundOnAnchorFocusHandler),null===(n=this.focusableElement)||void 0===n||n.addEventListener("blur",this.boundOnAnchorBlurHandler),null===(s=this.focusableElement)||void 0===s||s.addEventListener("keydown",this.boundOnKeyDownHandler),null===(i=this.focusableElement)||void 0===i||i.addEventListener("keyup",this.boundOnKeyUpHandler)}disposeComponent(){var e,t,n,s;super.disposeComponent(),null===(e=this.focusableElement)||void 0===e||e.removeEventListener("focus",this.boundOnAnchorFocusHandler),null===(t=this.focusableElement)||void 0===t||t.removeEventListener("blur",this.boundOnAnchorBlurHandler),null===(n=this.focusableElement)||void 0===n||n.removeEventListener("keydown",this.boundOnKeyDownHandler),null===(s=this.focusableElement)||void 0===s||s.removeEventListener("keyup",this.boundOnKeyUpHandler)}onAnchorFocus(e){var t;null===(t=this.grid)||void 0===t||t.notifyColumnResizeAnchorFocus(e.target)}onAnchorBlur(){var e;null===(e=this.grid)||void 0===e||e.notifyColumnResizeAnchorBlur()}onKeyDown(e){var t,n;e.keyCode===u.KeyCode.Left&&(e.preventDefault(),null===(t=this.grid)||void 0===t||t.notifyColumnResizeAnchorMove(x.Left)),e.keyCode===u.KeyCode.Right&&(e.preventDefault(),null===(n=this.grid)||void 0===n||n.notifyColumnResizeAnchorMove(x.Right))}onKeyUp(e){var t;e.keyCode!==u.KeyCode.Left&&e.keyCode!==u.KeyCode.Right||null===(t=this.grid)||void 0===t||t.notifyColumnResizeAnchorStopMove()}}),customElements.define("dxbl-column-resize-separator",w),customElements.define("dxbl-grid-column-chooser",class extends e{constructor(){super(),this.boundOnDragStartHandler=this.onDragStart.bind(this),this.boundOnDragStopHandler=this.onDragStop.bind(this),this.boundOnDragCancelHandler=this.onDragCancel.bind(this),this.grid=null,this.scrollViewer=null,this.itemsReorderHelper=new I(this.onItemsReording.bind(this)),this.handlePointerEventsMode=n.Dragging}get handlePointerEventsDelay(){return s}get useShadowDom(){return!1}initializeComponent(){super.initializeComponent(),this.addEventSubscriptions(),this.grid=L.findGrid(this.getAttribute(O)),this.scrollViewer=this.querySelector(`.${c.ClassName}`)}disposeComponent(){super.disposeComponent(),this.removeEventSubscriptions()}addEventSubscriptions(){this.addEventListener(i.eventName,this.boundOnDragStartHandler),this.addEventListener(o.eventName,this.boundOnDragStopHandler),this.addEventListener(r.eventName,this.boundOnDragCancelHandler)}removeEventSubscriptions(){this.removeEventListener(i.eventName,this.boundOnDragStartHandler),this.removeEventListener(o.eventName,this.boundOnDragStopHandler),this.removeEventListener(r.eventName,this.boundOnDragCancelHandler)}onDragStart(e){var t;const n=e.detail.source,s=n.target,i=s.closest(`.${b.ColumnChooserItemDragAnchorClassName}`),o=s.closest(`.${b.ColumnChooserItemClassName}`);if(null!=i&&null!=o){const e=Array.from(this.getElementsByClassName(b.ColumnChooserItemClassName));this.itemsReorderHelper.start(e,o,n),null===(t=this.scrollViewer)||void 0===t||t.startAutoScrolling(C.Vertical,(()=>{this.itemsReorderHelper.refreshUI()}))}}onDragStop(e){var t;this.itemsReorderHelper.stop(),null===(t=this.scrollViewer)||void 0===t||t.stopAutoScrolling()}onDragCancel(e){var t;this.itemsReorderHelper.cancel(),null===(t=this.scrollViewer)||void 0===t||t.stopAutoScrolling()}onItemsReording(e,t,n,s){const i=t.indexOf(n),o=e[n];let r=null;if(!(i===t.length-1)){r=e[t[i+1]]}this.applyStyles(e,o,r,s),s===R.Stop&&this.onItemsReorded(o,r)}applyStyles(e,t,n,s){for(let t=0;t<e.length;t++){const i=e[t],o=i.classList.contains(b.ColumnChooserDraggingItemNextSiblingClassName);(s!==R.ItemMoving||o&&i!==n)&&i.classList.remove(b.ColumnChooserDraggingItemNextSiblingClassName)}s===R.ItemMoving?(t.classList.contains(b.ColumnChooserDraggingItemClassName)||t.classList.add(b.ColumnChooserDraggingItemClassName),null==n||n.classList.contains(b.ColumnChooserDraggingItemNextSiblingClassName)||n.classList.add(b.ColumnChooserDraggingItemNextSiblingClassName)):(t.classList.remove(b.ColumnChooserDraggingItemClassName),null==n||n.classList.remove(b.ColumnChooserDraggingItemNextSiblingClassName))}onItemsReorded(e,t){if(null==this.grid)return;const n=parseInt(e.getAttribute("data-column-uid")),s=null!=t?parseInt(t.getAttribute("data-column-uid")):null;setTimeout((()=>{var e;return null===(e=this.grid)||void 0===e?void 0:e.onColumnChooserItemDragged(n,s)}),200)}});const A={loadModule:function(){}};export{L as DxGrid,T as DxGridTagName,O as DxGridUidAttributeName,A as default};
