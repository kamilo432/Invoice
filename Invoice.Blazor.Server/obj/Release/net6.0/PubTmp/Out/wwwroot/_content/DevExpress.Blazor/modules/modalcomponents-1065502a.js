import{_ as e}from"./_tslib-6e8ca86b.js";import{a as t,F as s,S as n,c as i}from"./capturemanager-91fa2b2d.js";import{v as o,B as a,g as r,d as l}from"./getPopupRootSingleton-f8347fe3.js";import{BranchActivatedEvent as d,BranchIdContext as c,BranchRefreshedEvent as h}from"./branch-2ea85171.js";import{d as u,I as p,V as b,c as m,D as g,T as f,P as w,a as y,b as v}from"./supportcaptureelement-51f73fdc.js";import{D as I,B as E}from"./dom-166a04be.js";import{C as S}from"./css-classes-f3f8ed66.js";import{D as C}from"./layouthelper-4b19d191.js";import{L as x}from"./logicaltreehelper-15991dcb.js";import{n as T}from"./nameof-factory-64d95f5b.js";import{C as D}from"./custom-events-helper-18f7786a.js";import{e as F}from"./property-d3853089.js";import{n as B}from"./custom-element-bd7061f2.js";import{$ as k,s as R}from"./lit-element-b0a6fcba.js";import{D as H,a as O}from"./popupportal-85248f1b.js";import"./eventhelper-8570b930.js";import"./rafaction-bba7928b.js";import"./data-qa-utils-8be7c726.js";import"./dx-ui-element-de378e9d.js";import"./lit-element-base-af247167.js";import"./rect-7fc5c2ef.js";import"./point-9c6ab88a.js";const L=new class{constructor(){this._shadowBranchEvent=new t,this._topShadowId=null,this.shadowSet=new Set}get shadowBranchChanged(){return this._shadowBranchEvent}register(e){this.shadowSet.add(e),this.raiseTopShadowStackChanged()}unregister(e){this.shadowSet.delete(e),this.raiseTopShadowStackChanged()}raiseTopShadowStackChanged(){const e=this.getTopShadowModal();if(this._topShadowId===e)return;this._topShadowId=e;this._shadowBranchEvent.raise({branch:e})}getTopShadowModal(){let e=-1,t="";for(const s of Array.from(this.shadowSet)){const n=o.getIndex(s);n>e&&(e=n,t=s)}return t}},K=S.Prefix+"-prevent-safari-scrolling";const P=new class{constructor(){this.paddingCoerced=!1,this.bodyScrollTop=0,this.bodyScrollPadding="",this.scrollLocked=!1,this.scrollLockHostSet=new Set}register(e){this.scrollLockHostSet.add(e),this.updateScrollLock()}unregister(e){this.scrollLockHostSet.delete(e),this.updateScrollLock()}updateScrollLock(){this.toggleBodyScroll(document.body,this.scrollLockHostSet.size>0)}toggleBodyScroll(e,t){t!==this.scrollLocked&&(this.scrollLocked=t,this.toggleScrollPadding(e,t),I.toggleClassName(e,"dxbl-modal-open",t),E.Safari&&this.toggleSafariScroll(e,t))}toggleScrollPadding(e,t){if(t){const t=C.getVerticalScrollbarWidth();if(0===t)return;this.paddingCoerced=!0;const s=parseInt(getComputedStyle(document.body).getPropertyValue("padding-right"),10);return this.bodyScrollPadding=document.body.style.paddingRight,void(e.style.paddingRight=`${s+t}px`)}this.paddingCoerced&&(e.style.paddingRight=this.bodyScrollPadding,this.paddingCoerced=!1)}toggleSafariScroll(e,t){t?(this.bodyScrollTop=window.pageYOffset,I.toggleClassName(e,K,t)):(I.toggleClassName(e,K,t),window.scrollTo(0,this.bodyScrollTop))}},A=["a[href]","audio[controls]","button",'[contenteditable]:not([contenteditable="false"])',"details>summary:first-of-type","details","input","select","textarea","[tabindex]","video[controls]"].join(",");class j{static getTabbables(e,t){const s=this.findTabbables(e,t),n=[],i=[];return s.forEach(((e,t)=>{const s=j.getTabIndex(e);0===s?n.push(e):i.push({index:t,tabIndex:s,item:e})})),i.sort(((e,t)=>e.tabIndex===t.tabIndex?e.index-t.index:e.tabIndex-t.tabIndex)).map((e=>e.item)).concat(n)}static findTabbables(e,t){const s=Array.from(e.querySelectorAll(A));return(t&&e.matches(A)||e.webkitMatchesSelector(A))&&s.unshift(e),s.filter(j.filterTabbable)}static filterTabbable(e){return!e.disabled&&(!j.isHiddenInput(e)&&(!j.isHidden(e)&&!(j.getTabIndex(e)<0)))}static getTabIndex(e){const t=e.getAttribute("tabindex");if(t){const e=parseInt(t,10);if(!isNaN(e))return e}return"true"===e.contentEditable||e.nodeName===u.audio||e.nodeName===u.video||e.nodeName===u.details?0:e.tabIndex}static isHiddenInput(e){return e.tagName===u.input&&e.getAttribute("type")===p.hidden}static isHidden(e){if(window.getComputedStyle(e).visibility===b.hidden)return!0;let t=e;for(;t;){if(window.getComputedStyle(e).display===m.none)return!0;t=t.parentElement}return!1}}class q{constructor(e){this.action=null,this.postponeAction=e}executePostpone(e){this.action=null,this.postponeAction()?e():this.action=e}execute(){this.action&&this.postponeAction()&&this.executeForce()}executeForce(){this.action&&this.action(),this.clear()}clear(){this.action=null}}const z=new class{constructor(){this.element=null,this.tabbables=[],this.lastFocusedElement=null,this.mutationObserver=new MutationObserver(this.handleMutations.bind(this)),this.focusPostponedAction=new q((()=>{var e,t;return null!==(t=(null===(e=this.tabbables)||void 0===e?void 0:e.length)>0)&&void 0!==t&&t})),this.documentFocusInHandler=this.documentFocusIn.bind(this),this.documentKeyDownHandler=this.documentKeyDown.bind(this),this.firstInnerElementKeyDownHandler=this.firstInnerElementKeyDown.bind(this),this.lastInnerElementKeyDownHandler=this.lastInnerElementKeyDown.bind(this),this.handleFocusOutHandler=this.handleFocusOut.bind(this),this.firstInnerElement=null,this.lastInnerElement=null}activate(e){if(this.element="string"==typeof e?document.querySelector(e):e,null===this.element)throw"element is null";this.lastFocusedElement=document.activeElement,this.subscribe(this.element),this.tabbables=j.getTabbables(this.element,!0),this.updateInnerElements(),this.subscribeInnerElementsKeyDown(),this.focusPostponedAction.executePostpone(this.forceFocusFirstElement.bind(this)),this.mutationObserver.observe(this.element,{subtree:!0,childList:!0})}deactivate(e){this.element&&(this.focusPostponedAction.clear(),this.mutationObserver.disconnect(),this.unsubscribeDocument(),this.unsubscribe(this.element),this.unsubscribeInnerElementsKeyDown(),e&&!x.containsElement(this.element,document.activeElement)&&this.lastFocusedElement&&s.restoreFocus(this.lastFocusedElement),this.element=null,this.lastFocusedElement=null,clearTimeout(this.updateTabbablesTimerID))}forceFocusFirstElement(){const e=this.tabbables[0];e&&(this.lastFocusedElement&&this.element&&x.containsElement(this.element,document.activeElement)||s.restoreFocus(e))}handleMutations(e){clearTimeout(this.updateTabbablesTimerID),this.updateTabbablesTimerID=setTimeout((()=>{this.tabbables=j.getTabbables(this.element,!0),this.unsubscribeInnerElementsKeyDown(),this.updateInnerElements(),this.subscribeInnerElementsKeyDown(),this.focusPostponedAction.execute()}),50)}subscribe(e){this.element.addEventListener("focusout",this.handleFocusOutHandler,!0)}unsubscribe(e){this.element.removeEventListener("focusout",this.handleFocusOutHandler,!0)}handleFocusOut(e){const t=e.relatedTarget;t?this.element.contains(t)||this.focusPostponedAction.executePostpone(this.forceFocusFirstElement.bind(this)):this.subscribeDocument()}subscribeDocument(){document.addEventListener("focusin",this.documentFocusInHandler),document.addEventListener("keydown",this.documentKeyDownHandler)}unsubscribeDocument(){document.removeEventListener("keydown",this.documentKeyDownHandler),document.removeEventListener("focusin",this.documentFocusInHandler)}documentKeyDown(e){var t;const s=e.target;if(s&&(this.element===s||(null===(t=this.element)||void 0===t?void 0:t.contains(s))))return;const n=this.element;n&&n.processKeyDown(e)}documentFocusIn(e){const t=e.target;if(!t)return;this.unsubscribeDocument();const s=e.relatedTarget;(s||this.element.contains(t))&&(!s||this.element.contains(s))||this.focusPostponedAction.executePostpone(this.forceFocusFirstElement.bind(this))}firstInnerElementKeyDown(e){var t;this.firstInnerElement===document.activeElement&&"Tab"===e.key&&e.shiftKey&&(e.preventDefault(),null===(t=this.lastInnerElement)||void 0===t||t.focus({preventScroll:!1}))}lastInnerElementKeyDown(e){var t;this.lastInnerElement!==document.activeElement||"Tab"!==e.key||e.shiftKey||(e.preventDefault(),null===(t=this.firstInnerElement)||void 0===t||t.focus({preventScroll:!1}))}unsubscribeInnerElementsKeyDown(){var e,t;null===(e=this.firstInnerElement)||void 0===e||e.removeEventListener("keydown",this.firstInnerElementKeyDownHandler),null===(t=this.lastInnerElement)||void 0===t||t.removeEventListener("keydown",this.lastInnerElementKeyDownHandler)}subscribeInnerElementsKeyDown(){var e,t;null===(e=this.firstInnerElement)||void 0===e||e.addEventListener("keydown",this.firstInnerElementKeyDownHandler),null===(t=this.lastInnerElement)||void 0===t||t.addEventListener("keydown",this.lastInnerElementKeyDownHandler)}updateInnerElements(){this.tabbables&&(this.firstInnerElement=this.tabbables[0],this.lastInnerElement=this.tabbables[this.tabbables.length-1])}},_=T();class N{constructor(e){this.closeReason=e}}class V extends CustomEvent{constructor(e){super(V.eventName,{detail:new N(e),bubbles:!0,composed:!0,cancelable:!0})}}V.eventName="dxbl-modal.closingRequested",D.register(V.eventName,(e=>e.detail));class M extends CustomEvent{constructor(e){super(M.eventName,{detail:new N(e),bubbles:!0,composed:!0,cancelable:!0})}}M.eventName="dxbl-modal.closingResultRequested",D.register(M.eventName,(e=>e.detail));let Z=class extends g{constructor(){super(...arguments),this._positionChangedEvent=new n,this.shadowSlotChangedHandler=this.handleShadowSlotChange.bind(this),this.topShadowBranchChangedHandler=this.handleTopShadowBranchChanged.bind(this),this.shadow=null,this.closingResultRequestedTcs=new f,this.popupDialog=null,this._zIndex=0,this.modal=null,this.shadingChangedEvent=new t,this._isOpen=!1,this.shading=!1,this.closeOnOutsideClick=!1,this.closeOnEscape=!1,this.autoZIndex=!1,this.manualZIndex=0,this.shadowVisible=!1,this.topShadowBranchId=null,this.hasServerSideClosing=!1,this.disableFocusTrap=!1}get positionChanged(){return this._positionChangedEvent}get renderedVisible(){return!0}get isOpen(){return this._isOpen}get branchType(){return a.Modal}get preventInteractions(){return!0}render(){return k`
            <dxbl-branch
                id="branch"
                branch-id="${this.branchId}"
                type="${this.branchType}">
                ${this.renderShadow()}
                ${this.renderDefaultSlot()}
            </dxbl-branch>
        `}renderDefaultSlot(){return k`<slot></slot>`}renderShadow(){return k`<slot name="shadow" @slotchange="${this.shadowSlotChangedHandler}"></slot>`}get zindex(){return this._zIndex}set zindex(e){e!==this._zIndex&&(this._zIndex=e,this.applyZIndexToModal())}handleShadowSlotChange(e){const t=e.target.assignedNodes();this.shadow=t.find((e=>e instanceof HTMLElement))}get shadingChanged(){return this.shadingChangedEvent}connectedCallback(){super.connectedCallback(),this.subscribeToEvents()}disconnectedCallback(){super.disconnectedCallback(),this.unsubscribeFromEvents(),this.close()}show(){this.isOpen||(this._isOpen=!0,this.initializeCapture(),this.initializeBodyScrollLock(),this.addToVisibleBranchTree())}close(){this.isOpen&&(this._isOpen=!1,this.releaseCapture(),this.releaseBodyScrollLock(),this.removeFromVisibleBranchTree())}willUpdate(e){this.shadowVisible=this.shading&&this.isOpen&&!!this.branchId&&this.branchId===this.topShadowBranchId}updated(e){this.shadow&&e.has(_("shadowVisible"))&&(this.shadow.style.display=this.shadowVisible?m.block:m.none),e.has(_("manualZIndex"))&&(this.style.zIndex=this.autoZIndex?"":String(this.manualZIndex))}ensureBranchId(){if(!this.branchId)throw new Error("branchId should not be null")}addToVisibleBranchTree(){this.ensureBranchId(),o.register(this.branchId),L.register(this.branchId),this.raiseBranchRefreshed()}removeFromVisibleBranchTree(){this.ensureBranchId(),o.unregister(this.branchId),L.unregister(this.branchId),this.raiseBranchRefreshed()}initializeBodyScrollLock(){P.register(this.branchId)}releaseBodyScrollLock(){P.unregister(this.branchId)}subscribeToEvents(){L.shadowBranchChanged.subscribe(this.topShadowBranchChangedHandler)}unsubscribeFromEvents(){L.shadowBranchChanged.unsubscribe(this.topShadowBranchChangedHandler)}handleTopShadowBranchChanged(e){this.topShadowBranchId=e.branch}initializeCapture(){i.capture(this)}releaseCapture(){this.processClosingRequested(!0),i.releaseCapture(this)}processClosingRequested(e){this.closingResultRequestedTcs.resolve(e),this.closingResultRequestedTcs=new f}applyZIndexToModal(){this.modal&&(this.modal.style.zIndex=this.zindex.toString(10))}notifyDialogConnected(e){this.popupDialog=e,this.initializeFocusTrap()}notifyDialogDisconnected(){this.popupDialog=null,this.initializeFocusTrap()}gotCapture(){super.gotCapture(),this.activate(),this.initializeFocusTrap()}lostCapture(){super.lostCapture(),this.releaseFocusTrap()}initializeFocusTrap(){this.isOpen&&this.popupDialog&&!this.disableFocusTrap&&z.activate(this.popupDialog)}releaseFocusTrap(){z.deactivate(!this.isOpen)}activate(){const e=new d(new c(this.branchId));this.dispatchEvent(e)}notifyCloseCanceled(){this.processClosingRequested(!1)}async processCapturedPointerDownAsync(e,t){t.handled||w.containsInComposedPath(e,this.popupDialog)||(t.nextInteractionHandled=!0,await y.processCapturedPointerDown(this,e,t))}async processCapturedKeyDownAsync(e,t){t.handled||this.closeOnEscape&&"Escape"===e.key&&await this.processEscape(e,t)}async processEscape(e,t){const s=await this.raiseClosingResultRequestedAsync(v.EscapePress);this.closingResultRequestedTcs=new f,s||(t.handled=!0)}async closeAsync(e,t){const s=await this.raiseClosingResultRequestedAsync(t);return this.closingResultRequestedTcs=new f,e.nextInteractionHandled=!0,e.handled=!0,Promise.resolve(!!s)}async closeHierarchyAsync(e,t,s){for(const e of o.iterateBranch(this.branchId)){const n=await r().getPopup(e);await(null==n?void 0:n.closeAsync(t,s))}await this.closeAsync(t,s)}async raiseClosingResultRequestedAsync(e){if(!this.hasServerSideClosing)return this.raiseClosingRequested(e),!0;const t=new f;return this.closingResultRequestedTcs=t,this.raiseClosingResultRequested(e),t.promise}raiseClosingRequested(e){this.dispatchEvent(new V(e))}raiseClosingResultRequested(e){this.dispatchEvent(new M(e))}raiseBranchRefreshed(){const e=new h(new c(this.branchId));this.dispatchEvent(e)}};e([F({type:Boolean,attribute:"x-is-open",reflect:!0,converter:{fromAttribute:(e,t)=>{throw new Error("readonly")}}})],Z.prototype,"_isOpen",void 0),e([F({type:Boolean,attribute:"shading"})],Z.prototype,"shading",void 0),e([F({type:Boolean,attribute:"close-on-outside-click"})],Z.prototype,"closeOnOutsideClick",void 0),e([F({type:Boolean,attribute:"close-on-escape"})],Z.prototype,"closeOnEscape",void 0),e([F({type:Boolean,attribute:"auto-z-index"})],Z.prototype,"autoZIndex",void 0),e([F({type:Number,attribute:"manual-z-index"})],Z.prototype,"manualZIndex",void 0),e([F({type:String,attribute:"branch-id"})],Z.prototype,"branchId",void 0),e([F({reflect:!1})],Z.prototype,"shadowVisible",void 0),e([F({reflect:!1})],Z.prototype,"topShadowBranchId",void 0),e([F({type:Boolean,attribute:"has-serverside-closing"})],Z.prototype,"hasServerSideClosing",void 0),e([F({type:Boolean,attribute:"disable-focus-trap"})],Z.prototype,"disableFocusTrap",void 0),Z=e([B("dxbl-modal")],Z);let $=class extends H{constructor(){super(...arguments),this.popup=null}connectedCallback(){super.connectedCallback(),this.popup=this.closest("dxbl-modal"),this.popup.notifyDialogConnected(this)}disconnectedCallback(){var e;super.disconnectedCallback(),null===(e=this.popup)||void 0===e||e.notifyDialogDisconnected(),this.popup=null}};$=e([B("dxbl-modal-dialog")],$);let U=class extends R{constructor(){super(...arguments),this.slotChangedHandler=this.handleSlotChange.bind(this)}render(){return k`
            <slot @slotchange=${this.slotChangedHandler}></slot>
        `}handleSlotChange(e){const t=e.target.assignedNodes().find((e=>e instanceof $)),s=this.closest("dxbl-modal");s&&(t?s.notifyDialogConnected(t):s.notifyDialogDisconnected())}};U=e([B("dxbl-modal-root")],U);const W=["dxbl-modal-dialog","dxbl-modal","dxbl-modal-root",l,O];function Y(e){if(!e)throw new Error("failed");return e}const G={getReference:Y,registeredComponents:W};export{G as default,Y as getReference,W as registeredComponents};
