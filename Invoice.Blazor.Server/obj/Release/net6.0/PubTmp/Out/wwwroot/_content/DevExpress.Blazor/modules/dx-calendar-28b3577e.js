import{D as e}from"./dom-166a04be.js";import{D as t}from"./dx-html-element-base-7f87ceb0.js";import{C as n}from"./css-classes-f3f8ed66.js";import{H as a,P as i,a as s,b as l}from"./dx-html-element-pointer-events-helper-0f2b6602.js";import{R as r}from"./rect-7fc5c2ef.js";import{C as o}from"./custom-events-helper-18f7786a.js";import{b as c}from"./constants-4c28185b.js";import"./_tslib-6e8ca86b.js";import"./data-qa-utils-8be7c726.js";import"./eventhelper-8570b930.js";import"./point-9c6ab88a.js";class d{}d.Prefix=n.Prefix+"-calendar",d.SelectedItem=d.Prefix+"-selected-item",d.SelectedRange=d.Prefix+"-selected-range",d.Content=d.Prefix+"-content";class h{constructor(e){this._pointerDownDate=e.pointerDownDate,this._pointerUpDate=null,this._clearSelection=e.clearSelection,this.dayCellElements=e.dayCellElements,this.refreshUI(!1)}get clearSelection(){return this._clearSelection}get pointerDownDate(){return this._pointerDownDate}get pointerUpDate(){return this._pointerUpDate}set pointerUpDate(e){this._pointerUpDate!==e&&e&&(this._pointerUpDate=e,this.refreshUI(!0))}get isValid(){return!!this._pointerUpDate}stop(){this.refreshUI(!1)}cancel(){for(let e=0;e<this.dayCellElements.length;e++){const t=this.dayCellElements[e];h.removeDayCellSelectedClasses(t),t.hasAttribute("data-selected")&&h.addSelectedClassesToCell(t)}}refreshUI(t){const n=this.getStartDateRange(),a=this.getEndDateRange();for(let i=0;i<this.dayCellElements.length;i++){const s=this.dayCellElements[i],l=Number(s.dataset.date);h.removeDayCellSelectedClasses(s),!t||l!==n&&l!==a||e.addClassName(s,d.SelectedRange),h.isApplySelectedStyle(l,n,a,t)&&h.addSelectedClassesToCell(s),s.hasAttribute("data-selected")&&!this.clearSelection&&h.addSelectedClassesToCell(s)}}getStartDateRange(){return this.pointerUpDate?Math.min(this.pointerUpDate.getTime(),this.pointerDownDate.getTime()):this.pointerDownDate.getTime()}getEndDateRange(){return this.pointerUpDate?Math.max(this.pointerUpDate.getTime(),this.pointerDownDate.getTime()):this.pointerDownDate.getTime()}static isApplySelectedStyle(e,t,n,a){return!(e<t||e>n)&&(!a||!h.isDateRangeBoundary(e,t,n))}static isDateRangeBoundary(e,t,n){return e===t||e===n}static addSelectedClassesToCell(t){e.addClassName(t,d.SelectedItem)}static removeDayCellSelectedClasses(t){e.removeClassName(t,d.SelectedItem),e.removeClassName(t,d.SelectedRange),e.removeClassName(t,"text-white")}}class p{constructor(e,t){this._pointerDownDate=e,this._pointerUpDate=null,this._clearSelection=t}get clearSelection(){return this._clearSelection}get pointerDownDate(){return this._pointerDownDate}get pointerUpDate(){return this._pointerUpDate}set pointerUpDate(e){this._pointerUpDate=e}get isValid(){var e;return this.pointerDownDate.getTime()===(null===(e=this.pointerUpDate)||void 0===e?void 0:e.getTime())}stop(){}cancel(){}}var m;!function(e){e[e.Month=0]="Month",e[e.Year=1]="Year",e[e.Years=2]="Years",e[e.Decades=3]="Decades"}(m||(m={}));class u extends CustomEvent{constructor(e,t,n){super(u.eventName,{detail:new D(e,t,n),bubbles:!0,composed:!0,cancelable:!0})}}u.eventName=c+".daycellpointerup";class D{constructor(e,t,n){this.PointerDownDate=e,this.PointerUpDate=t,this.ClearSelection=n}}o.register(u.eventName,(e=>e.detail));const S=document.createElement("template");S.innerHTML="\n<style></style>\n<slot />";class b extends t{constructor(){super(),this.boundOnStartDaySelectionHandler=this.onStartDaySelection.bind(this),this.boundOnStopDaySelectionHandler=this.onStopDaySelection.bind(this),this.boundOnCancelDaySelectionHandler=this.onCancelDaySelection.bind(this),this.boundOnDayCellPointerEnterHandler=this.onDayCellPointerEnter.bind(this),this._enableMultiSelect=!1,this.daySelectionRenderer=null,this.calendarTableResizeObserver=new ResizeObserver(this.onCalendarTableSizeChanged.bind(this))}get enableMultiSelect(){return this._enableMultiSelect}set enableMultiSelect(e){this._enableMultiSelect=e}connectedCallback(){super.connectedCallback(),this.addEventSubscriptions()}initializeComponent(){super.initializeComponent(),this.fixCalendarTableSize()}disposeComponent(){this.removeEventSubscriptions(),super.disposeComponent()}disconnectedCallback(){this.calendarTableResizeObserver.disconnect(),super.disconnectedCallback()}fixCalendarTableSize(){const e=this.getCalendarTableElement();e.style.width="",e.style.height="";const t=e.getBoundingClientRect();r.fromDomRect(t).isEmpty?this.calendarTableResizeObserver.observe(e):this.applyTableSize(e,t.width,t.height)}applyTableSize(e,t,n){e.style.width=t+"px",e.style.height=n+"px"}onCalendarTableSizeChanged(e){if(e.length<1)return;const t=e[0].target,n=e[0].contentRect;r.fromDomRect(n).isEmpty||(this.applyTableSize(t,n.width,n.height),this.calendarTableResizeObserver.disconnect())}addEventSubscriptions(){this.addEventListener(i.eventName,this.boundOnStartDaySelectionHandler),this.addEventListener(s.eventName,this.boundOnStopDaySelectionHandler),this.addEventListener(l.eventName,this.boundOnCancelDaySelectionHandler)}removeEventSubscriptions(){this.removeEventListener(i.eventName,this.boundOnStartDaySelectionHandler),this.removeEventListener(s.eventName,this.boundOnStopDaySelectionHandler),this.removeEventListener(l.eventName,this.boundOnCancelDaySelectionHandler)}addDayCellEventSubscriptions(){const e=this.findDayCellElements();for(let t=0;t<e.length;t++){e[t].addEventListener("pointerenter",this.boundOnDayCellPointerEnterHandler)}}removeDayCellEventSubscriptions(){const e=this.findDayCellElements();for(let t=0;t<e.length;t++){e[t].removeEventListener("pointerenter",this.boundOnDayCellPointerEnterHandler)}}onStartDaySelection(t){if(e.hasClassName(this,n.Disabled)||e.hasClassName(this,n.ReadOnly))return;const a=b.getDateFromTarget(t.detail.source.target);if(!a)return;this.daySelectionRenderer=this.createDaySelectionRenderer(a,!t.detail.isLongTap&&(!(t.detail.source.ctrlKey||t.detail.source.metaKey)||t.detail.isTouch)),this.addDayCellEventSubscriptions(),t.stopPropagation()}onStopDaySelection(e){this.daySelectionRenderer&&(this.daySelectionRenderer.pointerUpDate=b.getDateFromTarget(e.detail.source.target),this.daySelectionRenderer.stop(),this.raiseSelectionChanged(),this.removeDayCellEventSubscriptions(),this.daySelectionRenderer=null,e.stopPropagation())}onCancelDaySelection(e){this.daySelectionRenderer&&(this.daySelectionRenderer.cancel(),this.removeDayCellEventSubscriptions(),this.daySelectionRenderer=null,e.stopPropagation())}raiseSelectionChanged(){this.daySelectionRenderer&&this.daySelectionRenderer.isValid&&this.invokeDayCellPointerUp(this.daySelectionRenderer.pointerDownDate,this.daySelectionRenderer.pointerUpDate,this.daySelectionRenderer.clearSelection)}invokeDayCellPointerUp(e,t,n){this.dispatchEvent(new u(e,t,n))}onDayCellPointerEnter(e){if(!this.daySelectionRenderer)return;const t=b.getDateFromTarget(e.target);this.daySelectionRenderer.pointerUpDate=t}createDaySelectionRenderer(e,t){return this.enableMultiSelect?new h({pointerDownDate:e,clearSelection:t,dayCellElements:this.findDayCellElements()}):new p(e,t)}findDayCellElements(){return this.querySelectorAll(".dxbl-calendar-day")}getCalendarTableElement(){return this.querySelector(`.${d.Content} > table`)}static getDateFromTarget(e){const t=b.getDayCellByTarget(e);return t?b.getDateFromCell(t):null}static getDayCellByTarget(t){const n=t;return n?e.hasClassName(n,"dxbl-calendar-day")?n:n.closest(".dxbl-calendar-day"):null}static getDateFromCell(e){return new Date(Number(e.getAttribute("data-date")))}getContentTemplate(){return S}static get observedAttributes(){return["enable-multi-select"]}attributeChangedCallback(e,t,n){if("enable-multi-select"===e)this.enableMultiSelect=null!==n}}customElements.define("dxbl-calendar",b),customElements.define("dxbl-calendar-table-container",class extends t{constructor(){super(),this._view=m.Month}get view(){return this._view}set view(e){this._view=e,this.handlePointerEventsMode=a.None,this.view===m.Month&&(this.handlePointerEventsMode=a.Click|a.Dragging)}static get observedAttributes(){return["view"]}attributeChangedCallback(e,t,n){if("view"===e)this.view=Number(n)}});const y={loadModule:function(){}};export{y as default};
